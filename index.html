<!DOCTYPE html>
<!--
    Shadow Monarch's Training System
    ================================
    
    A Solo Leveling inspired fitness tracking application with RPG elements.
    
    Features:
    - User registration and profile management
    - Daily quests with XP and leveling system
    - Shadow powers progression (Extraction, Speed, Domain, Authority)
    - Exercise library with custom exercises
    - Mission/todo list system
    - Real-time clock and date tracking
    - Background video with audio controls
    - Responsive design with modern UI
    
    Technical Details:
    - Pure HTML/CSS/JavaScript (no frameworks)
    - localStorage for data persistence
    - JSON format for all data storage
    - Comprehensive error handling and data validation
    - Auto-backup system every 5 minutes
    - Data recovery and repair mechanisms
    
    Author: Shariff Usman
    Version: 1.0.0
    License: MIT
    
    File Structure:
    - index.html (main application)
    - bgv.mp4 (background video)
    - 1.jpg to 6.jpg (background images)
    - slbgm.mp4 (background music)
    - solo-leveling-statue-of-god-grin-smile-2k-wallpaper-uhdpaper.com-150@5@d.jpg (fallback image)
    
    Browser Compatibility:
    - Modern browsers with localStorage support
    - Video autoplay may require user interaction
    - File upload support for custom avatars and backgrounds
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Monarch's Training System</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --hunter-primary: #6e00ff;
            --hunter-secondary: #00ff9d;
            --hunter-dark: #0a0a1a;
            --hunter-darker: #050510;
            --hunter-card: rgba(18, 18, 37, 0.7);
            --hunter-accent: #ff3a3a;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #000000;
            color: white;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        #bg-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
            min-width: 100%;
            min-height: 100%;
            pointer-events: none;
            display: block;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(110,0,255,0.05) 0%, transparent 40%),
                        radial-gradient(circle at 80% 70%, rgba(0,255,157,0.05) 0%, transparent 40%);
            z-index: -1;
        }
        
        /* Background images for main content */
        .training-system {
            background-image: url('1.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .training-system::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.9)),
                        radial-gradient(circle at 20% 30%, rgba(110,0,255,0.15) 0%, transparent 40%),
                        radial-gradient(circle at 80% 70%, rgba(0,255,157,0.15) 0%, transparent 40%);
            z-index: -1;
        }
        
        .hunter-font {
            font-family: 'Orbitron', sans-serif;
        }
        
        .hunter-card {
            background: rgba(18,18,37,0.4);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5), inset 0 0 12px rgba(110,0,255,0.3);
            border: 1px solid rgba(110,0,255,0.3);
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .hunter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(110,0,255,0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .hunter-card:hover::before {
            left: 100%;
        }
        
        .hunter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(110,0,255,0.4), inset 0 0 18px rgba(110,0,255,0.5);
            border-color: rgba(110,0,255,0.5);
        }
        
        .hunter-header {
            background: linear-gradient(135deg, rgba(110,0,255,0.7), rgba(110,0,255,0.5));
            border-radius: 12px 12px 0 0;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(110,0,255,0.3);
            text-shadow: 0 0 6px rgba(110,0,255,0.8);
        }
        
        .xp-bar {
            height: 14px;
            background-color: rgba(110,0,255,0.3);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 0 6px rgba(0,0,0,0.6);
        }
        
        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--hunter-primary), var(--hunter-secondary));
            border-radius: 8px;
            transition: width 0.5s ease;
            box-shadow: 0 0 12px rgba(110,0,255,0.7);
        }
        
        .stat-circle {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: 3px solid rgba(110,0,255,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, rgba(110,0,255,0.2), transparent);
            margin: 0 auto;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .stat-circle:hover {
            transform: scale(1.15);
            box-shadow: 0 0 25px rgba(110,0,255,0.5);
        }
        
        .btn-hunter {
            background: linear-gradient(135deg, rgba(110,0,255,0.8), rgba(110,0,255,0.6));
            box-shadow: 0 2px 8px rgba(110,0,255,0.2);
            transition: all 0.3s ease;
            border: 1px solid rgba(110,0,255,0.3);
            backdrop-filter: blur(5px);
        }
        
        .btn-hunter:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(110,0,255,0.5);
        }
        
        .btn-hunter:active, .btn-accent:active {
            transform: scale(0.98);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, rgba(255,58,58,0.8), rgba(255,58,58,0.6));
            border: 1px solid rgba(255,58,58,0.3);
            backdrop-filter: blur(5px);
        }
        
        .btn-accent:hover {
            box-shadow: 0 5px 15px rgba(255,58,58,0.5);
        }
        
        .quest-item {
            border-left: 5px solid var(--hunter-primary);
            transition: all 0.3s ease;
            background-color: rgba(18,18,37,0.4);
            backdrop-filter: blur(5px);
        }
        
        .quest-item:hover {
            background-color: rgba(110,0,255,0.15);
            transform: translateX(5px);
        }
        
        .quest-complete {
            border-left-color: var(--hunter-secondary);
            opacity: 0.8;
        }
        
        .emergency-quest {
            border-left-color: var(--hunter-accent);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translateX(0); box-shadow: 0 0 10px rgba(255,58,58,0.5); }
            50% { transform: translateX(5px); box-shadow: 0 0 20px rgba(255,58,58,0.7); }
            100% { transform: translateX(0); box-shadow: 0 0 10px rgba(255,58,58,0.5); }
        }
        
        .exercise-card {
            background-color: rgba(18,18,37,0.4);
            border: 1px solid rgba(110,0,255,0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .exercise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(110,0,255,0.3);
            border-color: var(--hunter-primary);
        }
        
        .modal-overlay {
            background-color: rgba(5,5,16,0.95);
            backdrop-filter: blur(10px);
        }
        
        .neon-text {
            text-shadow: 0 0 12px rgba(110,0,255,0.8), 0 0 24px rgba(110,0,255,0.6);
        }
        
        .neon-accent {
            text-shadow: 0 0 12px rgba(0,255,157,0.8), 0 0 24px rgba(0,255,157,0.6);
        }
        
        .power-progress {
            height: 10px;
            background-color: rgba(110,0,255,0.3);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }
        
        .power-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--hunter-primary), var(--hunter-secondary));
            border-radius: 5px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(110,0,255,0.7);
        }
        
        .glow {
            animation: glow 1.5s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 8px rgba(110,0,255,0.6); }
            to { box-shadow: 0 0 25px rgba(110,0,255,0.9); }
        }
        
        .level-up {
            animation: levelUp 0.7s ease-out;
        }
        
        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.25); }
            100% { transform: scale(1); }
        }
        
        /* Streak counter animations */
        .streak-glow {
            animation: streakGlow 2s ease-in-out infinite;
        }
        
        @keyframes streakGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8), 0 0 30px rgba(34, 197, 94, 0.6); }
        }
        
        /* Date display animations */
        .date-pulse {
            animation: datePulse 1s ease-in-out;
        }
        
        @keyframes datePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* RGB Flowing Border Animation */
        .rgb-border {
            position: relative;
        }
        
        .rgb-border::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, 
                #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080, #ff0000);
            background-size: 400% 400%;
            animation: rgbFlow 3s ease-in-out infinite;
            z-index: -1;
            border-radius: 8px;
            margin: 2px;
        }
        
        .rgb-border::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            background: #000000;
            border-radius: 6px;
            z-index: -1;
        }
        
        @keyframes rgbFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Footer hover effects */
        .footer-link {
            position: relative;
            overflow: hidden;
        }
        
        .footer-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .footer-link:hover::before {
            left: 100%;
        }
        
        #avatar-container img {
            box-shadow: 0 0 30px 5px rgba(110,0,255,0.3), 0 0 0 8px rgba(0,255,157,0.1);
            transition: box-shadow 0.3s ease;
        }
        
        #avatar-container img:hover {
            box-shadow: 0 0 50px 10px rgba(110,0,255,0.5), 0 0 0 12px rgba(0,255,157,0.2);
        }
        
        .fade-in {
            animation: fadeIn 1s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-content {
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .landing-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            padding-bottom: 8rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .landing-btn {
            background: linear-gradient(135deg, var(--hunter-primary), var(--hunter-secondary));
            padding: 1.5rem 3rem;
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 20px rgba(110,0,255,0.7);
            transition: all 0.3s ease;
            border: none;
            backdrop-filter: blur(5px);
            min-width: 250px;
        }
        
        .landing-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(110,0,255,0.9);
        }
        
        .notification-sound {
            display: none;
        }
        
        /* Dropdown styling */
        select option {
            background-color: #1f2937 !important;
            color: white !important;
        }
        
        select:focus option:checked {
            background-color: #7c3aed !important;
        }
        
        .id-card-modal {
            background: linear-gradient(135deg, rgba(18,18,37,0.95), rgba(5,5,16,0.95));
            border: 2px solid var(--hunter-primary);
            border-radius: 16px;
            box-shadow: 0 0 30px rgba(110,0,255,0.6), inset 0 0 15px rgba(110,0,255,0.4);
            backdrop-filter: blur(12px);
            width: 100%;
            max-width: 800px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .id-card-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(110,0,255,0.1) 10px,
                rgba(110,0,255,0.1) 20px
            );
            opacity: 0.3;
        }
        
        .id-card-header {
            background: linear-gradient(135deg, rgba(110,0,255,0.8), rgba(0,255,157,0.6));
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1.5rem;
            box-shadow: 0 0 15px rgba(110,0,255,0.5);
        }
        
        .id-card-field {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(110,0,255,0.3);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }
        
        .avatar-option {
            width: 100%;
            height: 80px;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .avatar-option:hover {
            border-color: var(--hunter-primary);
            transform: scale(1.05);
        }
        
        .avatar-option.selected {
            border-color: var(--hunter-secondary);
            box-shadow: 0 0 10px rgba(0,255,157,0.5);
        }
        
        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 1024px) {
            .landing-section {
                padding: 1rem;
                padding-bottom: 6rem;
            }
            
            .landing-section h1 {
                font-size: 2.5rem;
                line-height: 1.2;
            }
            
            .landing-section p {
                font-size: 1rem;
            }
            
            .landing-btn {
                padding: 1.2rem 2.5rem;
                font-size: 1.3rem;
                min-width: 200px;
            }
            
            .id-card-modal {
                max-width: 90vw;
                margin: 1rem;
                padding: 1.5rem;
            }
            
            .hunter-card {
                margin-bottom: 1rem;
            }
            
            .hunter-header {
                padding: 1rem;
            }
            
            .hunter-header h2 {
                font-size: 1.1rem;
            }
            
            .stat-circle {
                width: 65px;
                height: 65px;
            }
            
            .stat-circle .text-2xl {
                font-size: 1.1rem;
            }
            
            .stat-circle .text-xs {
                font-size: 0.7rem;
            }
            
            #user-avatar {
                width: 100px;
                height: 100px;
            }
            
            .quest-item {
                padding: 0.75rem;
            }
            
            .quest-item .flex {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .quest-item .flex > div:first-child {
                order: 1;
            }
            
            .quest-item .flex > div:last-child {
                order: 2;
                align-self: flex-end;
            }
            
            .exercise-card {
                padding: 0.75rem;
            }
            
            .exercise-card .flex {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .power-item {
                padding: 0.75rem;
            }
            
            .power-item .flex {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .power-item .flex > div:first-child {
                order: 1;
            }
            
            .power-item .flex > div:last-child {
                order: 2;
                align-self: flex-end;
            }
            
            .modal-content {
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .id-card-field {
                padding: 0.75rem;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .avatar-option {
                height: 70px;
            }
            
            /* Clock widget mobile optimization */
            #digital-clock-widget {
                margin-left: 0.5rem;
                min-width: 100px;
            }
            
            #digital-clock-widget > div:first-child {
                font-size: 0.9rem;
                padding: 0.1rem 0.5rem;
            }
            
            #digital-clock-widget > div:last-child {
                font-size: 0.7rem;
                padding: 0.05rem 0.4rem;
            }
            
            /* Header mobile optimization */
            header h1 {
                font-size: 2rem;
                line-height: 1.1;
            }
            
            header p {
                font-size: 0.9rem;
            }
            
            /* Footer mobile optimization */
            #main-footer {
                padding: 1rem;
            }
            
            #main-footer .max-w-6xl {
                padding: 0;
            }
            
            #main-footer .flex-col {
                gap: 0.5rem;
            }
            
            #main-footer .text-sm {
                font-size: 0.75rem;
            }
            
            /* Button mobile optimization */
            .btn-hunter, .btn-accent {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }
            
            /* Input mobile optimization */
            input, select, textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            /* Modal mobile optimization */
            .modal-overlay {
                padding: 0.5rem;
            }
            
            .hunter-card {
                border-radius: 12px;
            }
            
            .hunter-header {
                border-radius: 12px 12px 0 0;
            }
        }
        
        @media (max-width: 768px) {
            .landing-section h1 {
                font-size: 2rem;
            }
            
            .landing-btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
                min-width: 180px;
            }
            
            .stat-circle {
                width: 60px;
                height: 60px;
            }
            
            .stat-circle .text-2xl {
                font-size: 1rem;
            }
            
            .stat-circle .text-xs {
                font-size: 0.6rem;
            }
            
            #user-avatar {
                width: 80px;
                height: 80px;
            }
            
            .hunter-header h2 {
                font-size: 1rem;
            }
            
            .quest-item {
                padding: 0.5rem;
            }
            
            .exercise-card {
                padding: 0.5rem;
            }
            
            .power-item {
                padding: 0.5rem;
            }
            
            .id-card-modal {
                max-width: 95vw;
                margin: 0.5rem;
                padding: 1rem;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .avatar-option {
                height: 60px;
            }
            
            /* Clock widget smaller */
            #digital-clock-widget {
                min-width: 80px;
            }
            
            #digital-clock-widget > div:first-child {
                font-size: 0.8rem;
                padding: 0.05rem 0.4rem;
            }
            
            #digital-clock-widget > div:last-child {
                font-size: 0.6rem;
                padding: 0.02rem 0.3rem;
            }
            
            /* Header smaller */
            header h1 {
                font-size: 1.5rem;
            }
            
            header p {
                font-size: 0.8rem;
            }
            
            /* Footer smaller */
            #main-footer {
                padding: 0.75rem;
            }
            
            #main-footer .text-sm {
                font-size: 0.7rem;
            }
            
            /* Buttons smaller */
            .btn-hunter, .btn-accent {
                padding: 0.6rem 1.2rem;
                font-size: 0.8rem;
            }
            
            /* Fixed positioning adjustments */
            #signOutBtn {
                top: 0.5rem;
                left: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
            }
            
            .fixed.top-4.left-32 {
                top: 0.5rem;
                left: 5rem;
            }
            
            #videoVolumeBtn {
                bottom: 0.5rem;
                left: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
            }
        }
        
        @media (max-width: 480px) {
            .landing-section {
                padding: 0.5rem;
                padding-bottom: 5rem;
            }
            
            .landing-section h1 {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
            
            .landing-section p {
                font-size: 0.8rem;
                margin-bottom: 1.5rem;
            }
            
            .landing-btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
                min-width: 150px;
                margin: 0.25rem;
            }
            
            .stat-circle {
                width: 50px;
                height: 50px;
            }
            
            .stat-circle .text-2xl {
                font-size: 0.9rem;
            }
            
            .stat-circle .text-xs {
                font-size: 0.5rem;
            }
            
            #user-avatar {
                width: 70px;
                height: 70px;
            }
            
            .hunter-header h2 {
                font-size: 0.9rem;
            }
            
            .quest-item {
                padding: 0.4rem;
            }
            
            .exercise-card {
                padding: 0.4rem;
            }
            
            .power-item {
                padding: 0.4rem;
            }
            
            .id-card-modal {
                max-width: 98vw;
                margin: 0.25rem;
                padding: 0.75rem;
            }
            
            .avatar-grid {
                grid-template-columns: 1fr;
                gap: 0.4rem;
            }
            
            .avatar-option {
                height: 50px;
            }
            
            /* Clock widget very small */
            #digital-clock-widget {
                min-width: 70px;
                margin-left: 0.25rem;
            }
            
            #digital-clock-widget > div:first-child {
                font-size: 0.7rem;
                padding: 0.02rem 0.3rem;
            }
            
            #digital-clock-widget > div:last-child {
                font-size: 0.5rem;
                padding: 0.01rem 0.2rem;
            }
            
            /* Header very small */
            header h1 {
                font-size: 1.2rem;
            }
            
            header p {
                font-size: 0.7rem;
            }
            
            /* Footer very small */
            #main-footer {
                padding: 0.5rem;
            }
            
            #main-footer .text-sm {
                font-size: 0.6rem;
            }
            
            /* Buttons very small */
            .btn-hunter, .btn-accent {
                padding: 0.5rem 1rem;
                font-size: 0.7rem;
            }
            
            /* Fixed positioning very small */
            #signOutBtn {
                top: 0.25rem;
                left: 0.25rem;
                padding: 0.3rem 0.6rem;
                font-size: 0.6rem;
            }
            
            .fixed.top-4.left-32 {
                top: 0.25rem;
                left: 4rem;
            }
            
            #videoVolumeBtn {
                bottom: 0.25rem;
                left: 0.25rem;
                padding: 0.3rem 0.6rem;
                font-size: 0.6rem;
            }
            
            /* Grid adjustments for very small screens */
            .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .grid-cols-1.lg\:grid-cols-4 {
                grid-template-columns: 1fr;
            }
            
            /* Modal adjustments */
            .modal-content {
                max-height: 95vh;
            }
            
            /* Text size adjustments */
            .text-xl {
                font-size: 1rem;
            }
            
            .text-lg {
                font-size: 0.9rem;
            }
            
            .text-sm {
                font-size: 0.8rem;
            }
            
            .text-xs {
                font-size: 0.7rem;
            }
            
            /* Spacing adjustments */
            .space-y-6 > * + * {
                margin-top: 1rem;
            }
            
            .space-y-4 > * + * {
                margin-top: 0.75rem;
            }
            
            .gap-6 {
                gap: 1rem;
            }
            
            .gap-4 {
                gap: 0.75rem;
            }
            
            .gap-3 {
                gap: 0.5rem;
            }
            
            /* Padding adjustments */
            .p-6 {
                padding: 0.75rem;
            }
            
            .p-4 {
                padding: 0.5rem;
            }
            
            .px-4 {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            .py-2 {
                padding-top: 0.25rem;
                padding-bottom: 0.25rem;
            }
            
            /* Margin adjustments */
            .mb-8 {
                margin-bottom: 1rem;
            }
            
            .mb-6 {
                margin-bottom: 0.75rem;
            }
            
            .mb-4 {
                margin-bottom: 0.5rem;
            }
            
            .mt-8 {
                margin-top: 1rem;
            }
            
            .mt-6 {
                margin-top: 0.75rem;
            }
            
            .mt-4 {
                margin-top: 0.5rem;
            }
        }
        
        /* Landscape orientation adjustments */
        @media (max-width: 768px) and (orientation: landscape) {
            .landing-section {
                padding: 0.5rem;
                padding-bottom: 3rem;
            }
            
            .landing-section h1 {
                font-size: 1.8rem;
            }
            
            .landing-btn {
                padding: 0.6rem 1.5rem;
                font-size: 0.9rem;
            }
            
            #user-avatar {
                width: 60px;
                height: 60px;
            }
            
            .stat-circle {
                width: 45px;
                height: 45px;
            }
            
            .stat-circle .text-2xl {
                font-size: 0.8rem;
            }
            
            .stat-circle .text-xs {
                font-size: 0.4rem;
            }
            
            header h1 {
                font-size: 1.3rem;
            }
            
            header p {
                font-size: 0.7rem;
            }
            
            .hunter-header h2 {
                font-size: 0.8rem;
            }
            
            .quest-item, .exercise-card, .power-item {
                padding: 0.3rem;
            }
            
            .btn-hunter, .btn-accent {
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
            }
            
            #main-footer {
                padding: 0.3rem;
            }
            
            #main-footer .text-sm {
                font-size: 0.5rem;
            }
        }
        
        /* High DPI screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .hunter-card {
                border-width: 0.5px;
            }
            
            .btn-hunter, .btn-accent {
                border-width: 0.5px;
            }
        }
        
        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn-hunter:hover, .btn-accent:hover {
                transform: none;
            }
            
            .hunter-card:hover {
                transform: none;
            }
            
            .exercise-card:hover {
                transform: none;
            }
            
            .quest-item:hover {
                transform: none;
            }
            
            .stat-circle:hover {
                transform: none;
            }
            
            /* Increase touch targets */
            .btn-hunter, .btn-accent {
                min-height: 44px;
            }
            
            input, select, textarea {
                min-height: 44px;
            }
            
            .avatar-option {
                min-height: 44px;
            }
        }
        
        /* Loading animation */
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Background Video -->
    <video id="bg-video" autoplay loop playsinline preload="auto" volume="0.3">
        <source src="bgv.mp4" type="video/mp4">
        <source src="bgv.webm" type="video/webm">
        Your browser does not support the video tag.
    </video>
    
    <!-- Notification Sounds -->
    <audio id="quest-complete-sound" class="notification-sound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_5a76a9e9b2.mp3"></audio>
    <audio id="level-up-sound" class="notification-sound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_3c5b7a1f7e.mp3"></audio>
    <audio id="power-up-sound" class="notification-sound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_8f1b8a4e7d.mp3"></audio>
    
    <!-- Sign Out Button -->
    <button id="signOutBtn" class="fixed top-4 left-4 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm font-bold transition-colors z-50 hidden">
        <i class="fas fa-sign-out-alt mr-1"></i> Sign Out
    </button>
    
    <!-- System Status Indicator -->
    <div class="fixed top-4 left-32 flex items-center space-x-2">
        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
        <span class="text-green-400 text-sm font-bold hunter-font hidden sm:inline">SYSTEM ONLINE</span>
        <span class="text-green-400 text-xs font-bold hunter-font sm:hidden">ONLINE</span>
    </div>
    
    <!-- Video Volume Control -->
    <button id="videoVolumeBtn" class="fixed bottom-4 left-4 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm font-bold transition-colors z-50">
        <i class="fas fa-volume-up mr-1"></i> <span class="hidden sm:inline">Audio</span>
    </button>
    
    <!-- Customization Modal (ID Card Style) -->
    <div id="customizationModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay">
        <div class="id-card-modal relative modal-content">
            <div class="id-card-header hunter-font neon-text mb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-2xl font-bold"><i class="fas fa-id-card mr-2"></i> HUNTER ID REGISTRATION</h2>
                        <p class="text-sm text-gray-400 mt-1">Enter your details to begin your journey as a Shadow Monarch</p>
                    </div>
                    <button id="closeCustomizationModal" type="button" class="text-gray-400 hover:text-white text-2xl transition-colors cursor-pointer p-2 hover:bg-gray-700 rounded-lg" onclick="closeCustomizationModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="relative z-10">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Left Column - Basic Info -->
                    <div class="space-y-4">
                        <div class="id-card-field">
                            <label class="block text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-user mr-2"></i> Hunter Name
                            </label>
                            <input type="text" id="hunterNameInput" class="w-full bg-transparent border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20" placeholder="Enter your hunter name">
                        </div>
                        
                        <div class="id-card-field">
                            <label class="block text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-upload mr-2"></i> Custom Avatar Upload
                            </label>
                            <input type="file" id="avatarUpload" accept="image/*" class="w-full text-gray-400 text-sm bg-transparent border border-gray-700 rounded-lg px-3 py-2">
                            <p class="text-xs text-gray-500 mt-1">Max 2MB (JPG, PNG)</p>
                        </div>
                        
                        <div class="id-card-field">
                            <label class="block text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-image mr-2"></i> Background Theme
                            </label>
                            <select id="bgSelect" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20">
                                <option value="1" class="bg-gray-800 text-white">Shadow Monarch's Throne</option>
                                <option value="2" class="bg-gray-800 text-white">Dark Dungeon Depths</option>
                                <option value="3" class="bg-gray-800 text-white">Mystic Forest Realm</option>
                                <option value="4" class="bg-gray-800 text-white">Shadow Army Formation</option>
                                <option value="5" class="bg-gray-800 text-white">Gate of the Monarch</option>
                                <option value="6" class="bg-gray-800 text-white">Solo Leveling Sanctuary</option>
                                <option value="custom" class="bg-gray-800 text-white">Custom Upload</option>
                            </select>
                        </div>
                        
                        <div class="id-card-field hidden" id="bgUploadContainer">
                            <label class="block text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-upload mr-2"></i> Custom Background Upload
                            </label>
                            <input type="file" id="bgUpload" accept="image/*" class="w-full text-gray-400 text-sm bg-transparent border border-gray-700 rounded-lg px-3 py-2">
                            <p class="text-xs text-gray-500 mt-1">Max 5MB (JPG, PNG)</p>
                        </div>
                    </div>
                    
                    <!-- Right Column - Preview -->
                    <div class="space-y-4">
                        <div class="id-card-field">
                            <label class="block text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-eye mr-2"></i> Hunter Preview
                            </label>
                            <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700">
                                <div class="text-center">
                                    <div class="relative inline-block mb-3">
                                        <img id="preview-avatar" src="https://i.imgur.com/Jz5ZQYt.jpg" class="w-20 h-20 rounded-full border-4 border-purple-600/50 object-cover mx-auto">
                                        <div class="absolute bottom-0 right-0 bg-purple-600 rounded-full px-2 py-1 text-xs font-bold">
                                            LV 1
                                        </div>
                                    </div>
                                    <h3 class="text-lg font-bold hunter-font neon-accent" id="preview-name">Hunter</h3>
                                    <p class="text-gray-400 text-sm">Rank: E</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="id-card-field">
                            <label class="block text-gray-300 text-sm font-bold mb-2">
                                <i class="fas fa-info-circle mr-2"></i> System Info
                            </label>
                            <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700 space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Status:</span>
                                    <span class="text-green-400 font-bold">Ready</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Storage:</span>
                                    <span class="text-blue-400">Local</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Version:</span>
                                    <span class="text-purple-400">1.0.0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-center mt-8">
                    <button id="saveCustomization" class="btn-hunter px-8 py-3 rounded-lg hunter-font text-lg">
                        <i class="fas fa-save mr-2"></i> Register Hunter
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- User Selection Modal -->
    <div id="userSelectionModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay hidden">
        <div class="hunter-card w-full max-w-md relative modal-content">
            <div class="hunter-header flex justify-between items-center">
                <h2 class="text-xl font-bold"><i class="fas fa-users mr-2"></i> SELECT HUNTER</h2>
                <button id="closeUserSelectionModal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <p class="text-gray-300 text-sm mb-4">Choose a registered hunter to continue your journey:</p>
                    <div id="registeredUsersList" class="space-y-3">
                        <!-- Users will be populated here -->
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <button id="registerNewUserBtn" class="btn-hunter px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-user-plus mr-2"></i> Register New Hunter
                    </button>
                    <button id="cancelUserSelection" class="px-4 py-2 rounded-lg border border-gray-600 hover:bg-gray-700 transition text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Landing Page -->
    <section id="landing-page" class="landing-section hidden">
        <h1 class="text-4xl md:text-7xl font-bold hunter-font neon-text mb-4">
            SHADOW MONARCH'S TRAINING SYSTEM
        </h1>
        <p class="text-lg text-gray-300 mb-6">
            Developed and Maintained by 
            <a href="https://www.linkedin.com/in/usman-shariff0514/" target="_blank" class="text-purple-400 hover:text-purple-300">Shariff Usman</a>
        </p>
        <div class="flex flex-col md:flex-row gap-4 justify-center">
            <button id="register-hunter" class="landing-btn hunter-font neon-text">
                <i class="fas fa-user-plus mr-2"></i> Register Hunter
            </button>
            <button id="begin-hunt" class="landing-btn hunter-font neon-text">
                <i class="fas fa-play mr-2"></i> Let's Begin the Hunt
            </button>
        </div>
    </section>
    
    <!-- Training System -->
    <section id="training-system" class="hidden p-4 md:p-8 pb-32 training-system">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <header class="mb-10 text-center fade-in">
                <h1 class="text-3xl md:text-6xl font-bold hunter-font neon-text mb-2">
                    SHADOW MONARCH'S TRAINING SYSTEM
                </h1>
                <p class="text-xl text-gray-300">Welcome <span id="hunter-name" class="text-purple-400">Hunter</span>, Ascend through daily training like Sung Jin-Woo</p>
            </header>
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Left Column - Profile and Stats -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Hunter Profile -->
                    <div class="hunter-card fade-in mb-8">
                        <div class="hunter-header">
                            <h2 class="text-xl font-bold"><i class="fas fa-id-card mr-2"></i> HUNTER PROFILE</h2>
                        </div>
                        <div class="p-6">
                            <div class="text-center mb-6">
                                <div class="relative inline-block" id="avatar-container">
                                    <img id="user-avatar" src="https://i.imgur.com/Jz5ZQYt.jpg" class="w-32 h-32 rounded-full border-4 border-purple-600/50 object-cover mx-auto mb-3">
                                    <div class="absolute bottom-0 right-0 bg-purple-600 rounded-full px-3 py-1 text-sm font-bold" id="hunter-level">
                                        LV 1
                                    </div>
                                </div>
                                <h3 class="text-xl font-bold hunter-font neon-accent" id="hunter-title">Novice Hunter</h3>
                                <p class="text-gray-400">Rank: <span id="hunter-rank">E</span></p>
                            </div>
                            <!-- Responsive stat circles: compact version -->
                            <div class="flex flex-row justify-center items-center gap-3 mb-6">
                                <div class="flex flex-col items-center">
                                    <div class="stat-circle" id="str-stat" style="width:60px;height:60px;">
                                        <div class="text-center">
                                            <div class="text-xs text-gray-400">STR</div>
                                            <div class="text-2xl font-bold">1</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-center">
                                    <div class="stat-circle" id="agi-stat" style="width:60px;height:60px;">
                                        <div class="text-center">
                                            <div class="text-xs text-gray-400">AGI</div>
                                            <div class="text-2xl font-bold">1</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-center">
                                    <div class="stat-circle" id="end-stat" style="width:60px;height:60px;">
                                        <div class="text-center">
                                            <div class="text-xs text-gray-400">END</div>
                                            <div class="text-2xl font-bold">1</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-6">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">XP Progress</span>
                                    <span class="text-sm text-gray-400"><span id="current-xp">0</span>/<span id="max-xp">100</span> XP</span>
                                </div>
                                <div class="xp-bar">
                                    <div class="xp-progress" id="xp-progress-bar" style="width: 0%;"></div>
                                </div>
                            </div>
                            <button id="openCustomization" class="btn-hunter w-full py-3 rounded-lg mt-3">
                                <i class="fas fa-cog mr-2"></i> Customize Profile
                            </button>
                            <button id="resetProgress" class="btn-accent w-full py-3 rounded-lg mt-3">
                                <i class="fas fa-redo mr-2"></i> Reset Progress
                            </button>
                            <button id="deleteUser" class="bg-red-600 hover:bg-red-700 w-full py-3 rounded-lg mt-3 text-white font-bold transition">
                                <i class="fas fa-trash mr-2"></i> Delete User
                            </button>
                        </div>
                    </div>
                    
                    <!-- Inventory -->
                    <div class="hunter-card fade-in mb-8">
                        <div class="hunter-header">
                            <h2 class="text-xl font-bold"><i class="fas fa-backpack mr-2"></i> SHADOW POWERS</h2>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="power-item">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center">
                                            <div class="bg-purple-600/20 p-2 rounded-lg mr-3">
                                                <i class="fas fa-flask text-purple-400"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold">Shadow Extraction</h4>
                                                <p class="text-xs text-gray-400">Convert defeated enemies to shadows</p>
                                            </div>
                                        </div>
                                        <span class="text-xs bg-gray-700 px-2 py-1 rounded">Lv <span class="power-level" data-power="extraction">0</span></span>
                                    </div>
                                    <div class="power-progress mt-2">
                                        <div class="power-progress-bar" data-power="extraction" style="width: 0%;"></div>
                                    </div>
                                </div>
                                
                                <div class="power-item">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center">
                                            <div class="bg-green-600/20 p-2 rounded-lg mr-3">
                                                <i class="fas fa-running text-green-400"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold">Dominator's Speed</h4>
                                                <p class="text-xs text-gray-400">Enhanced movement and reflexes</p>
                                            </div>
                                        </div>
                                        <span class="text-xs bg-gray-700 px-2 py-1 rounded">Lv <span class="power-level" data-power="speed">0</span></span>
                                    </div>
                                    <div class="power-progress mt-2">
                                        <div class="power-progress-bar" data-power="speed" style="width: 0%;"></div>
                                    </div>
                                </div>
                                
                                <div class="power-item">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center">
                                            <div class="bg-blue-600/20 p-2 rounded-lg mr-3">
                                                <i class="fas fa-shield-alt text-blue-400"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold">Monarch's Domain</h4>
                                                <p class="text-xs text-gray-400">Area control and defense</p>
                                            </div>
                                        </div>
                                        <span class="text-xs bg-gray-700 px-2 py-1 rounded">Lv <span class="power-level" data-power="domain">0</span></span>
                                    </div>
                                    <div class="power-progress mt-2">
                                        <div class="power-progress-bar" data-power="domain" style="width: 0%;"></div>
                                    </div>
                                </div>
                                
                                <div class="power-item">
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center">
                                            <div class="bg-red-600/20 p-2 rounded-lg mr-3">
                                                <i class="fas fa-fist-raised text-red-400"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold">Ruler's Authority</h4>
                                                <p class="text-xs text-gray-400">Command over shadows</p>
                                            </div>
                                        </div>
                                        <span class="text-xs bg-gray-700 px-2 py-1 rounded">Lv <span class="power-level" data-power="authority">0</span></span>
                                    </div>
                                    <div class="power-progress mt-2">
                                        <div class="power-progress-bar" data-power="authority" style="width: 0%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column - Main Content -->
                <div class="lg:col-span-3 space-y-6">
                    <!-- Daily Quests -->
                    <div class="hunter-card fade-in mb-8">
                        <div class="hunter-header flex justify-between items-center">
                            <h2 class="text-xl font-bold"><i class="fas fa-scroll mr-2"></i> DAILY QUESTS</h2>
                            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3">
                                <div class="flex items-center gap-2">
                                    <span class="bg-green-600/50 px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-bold streak-glow" id="streak-counter">
                                        🔥 Day <span id="streak-days">1</span> <span class="hidden sm:inline">Streak</span> <i class="fas fa-fire ms-1 text-yellow-300"></i>
                                    </span>
                                    <button id="reset-daily" class="bg-gray-700 hover:bg-gray-600 px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm">
                                        <i class="fas fa-sync-alt"></i> <span class="hidden sm:inline">Reset</span>
                                    </button>
                                </div>
                                <!-- Modern Clock Widget -->
                                <div id="digital-clock-widget" class="mt-2 sm:mt-0 sm:ml-4" style="min-width: 120px;">
                                    <div style="font-family: 'Orbitron', monospace; font-size: 1.1rem; background: #18181b; color: #00ff9d; border-radius: 8px; box-shadow: 0 0 8px #00ff9d44; padding: 0.2rem 1rem; letter-spacing: 0.1em; border: 1.5px solid #00ff9d; text-align: right;">
                                        <span id="digital-clock">00:00:00</span>
                                    </div>
                                    <div style="font-family: 'Orbitron', monospace; font-size: 0.8rem; background: #18181b; color: #fff; border-radius: 6px; padding: 0.1rem 0.7rem; border: 1px solid #333; margin-top: 0.1rem; text-align: right;">
                                        <span id="digital-date">1970-01-01</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4" id="quests-container"></div>
                            <div class="mt-8 text-center">
                                <button id="openQuestModal" class="btn-hunter px-6 py-3 rounded-lg">
                                    <i class="fas fa-plus mr-2"></i> Add Custom Quest
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Exercise Library Preview -->
                    <div class="hunter-card fade-in mb-8">
                        <div class="hunter-header">
                            <h2 class="text-xl font-bold"><i class="fas fa-dumbbell mr-2"></i> EXERCISE LIBRARY</h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="exercise-preview"></div>
                            <div class="mt-6 text-center">
                                <button id="openExerciseModal" class="btn-hunter px-6 py-3 rounded-lg">
                                    <i class="fas fa-book-open mr-2"></i> View Full Library
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Shadow Command Center (To-Do List) -->
                    <div class="hunter-card fade-in mb-8">
                        <div class="hunter-header">
                            <h2 class="text-xl font-bold"><i class="fas fa-tasks mr-2"></i> SHADOW COMMAND CENTER</h2>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-col sm:flex-row mb-4 gap-2 sm:gap-0">
                                <input
                                    type="text"
                                    id="mission-input"
                                    class="flex-1 bg-gray-800 border border-gray-700 rounded-lg sm:rounded-l-lg sm:rounded-r-none px-4 py-2 focus:border-purple-500 focus:outline-none"
                                    placeholder="Issue new shadow command..."
                                />
                                <button id="add-mission" class="btn-hunter px-4 py-2 rounded-lg sm:rounded-l-none sm:rounded-r-lg">
                                    <i class="fas fa-plus"></i> <span class="hidden sm:inline">Add</span>
                                </button>
                            </div>
                            <div class="space-y-2" id="mission-list"></div>
                            <div class="grid grid-cols-2 gap-4 mt-6">
                                <div class="text-center">
                                    <div class="text-sm text-gray-400 mb-1">Active Missions</div>
                                    <div class="text-xl font-bold" id="active-missions-count">0</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm text-gray-400 mb-1">Completed</div>
                                    <div class="text-xl font-bold" id="completed-missions-count">0</div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center mt-4 text-sm text-gray-400">
                                <button id="clear-missions" class="hover:text-gray-300">
                                    <i class="fas fa-trash mr-1"></i> Purge Completed
                                </button>
                                <button id="save-missions" class="hover:text-purple-400">
                                    <i class="fas fa-save mr-1"></i> Secure Archives
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add Quest Modal -->
        <div id="questModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-overlay">
            <div class="hunter-card w-full max-w-md relative modal-content">
                <div class="hunter-header flex justify-between items-center">
                    <h2 class="text-xl font-bold"><i class="fas fa-plus-circle mr-2"></i> CREATE NEW QUEST</h2>
                    <button id="closeQuestModal" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">Quest Type</label>
                        <select id="questType" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                            <option value="main">Main Quest (Primary Workout)</option>
                            <option value="side">Side Quest (Accessory Exercise)</option>
                            <option value="emergency">Emergency Quest (Challenge)</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">Quest Name</label>
                        <input type="text" id="questName" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none" placeholder="e.g. Shadow Squats">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">Description</label>
                        <input type="text" id="questDescription" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none" placeholder="e.g. 4 sets x 15 reps">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">XP Reward</label>
                        <input type="number" id="questXP" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none" placeholder="e.g. 100" value="50">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 mb-2">Power to Enhance</label>
                        <select id="questPower" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                            <option value="extraction">Shadow Extraction</option>
                            <option value="speed">Dominator's Speed</option>
                            <option value="domain">Monarch's Domain</option>
                            <option value="authority">Ruler's Authority</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button id="cancelQuest" class="px-4 py-2 rounded-lg border border-gray-600 hover:bg-gray-700 transition">
                            Cancel
                        </button>
                        <button id="saveQuest" class="btn-hunter px-6 py-2 rounded-lg">
                            Save Quest
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Exercise Library Modal -->
        <div id="exerciseModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-overlay">
            <div class="hunter-card w-full max-w-4xl relative max-h-[90vh] overflow-y-auto modal-content">
                <div class="hunter-header flex justify-between items-center sticky top-0 z-10">
                    <h2 class="text-xl font-bold"><i class="fas fa-dumbbell mr-2"></i> EXERCISE LIBRARY</h2>
                    <button id="closeExerciseModal" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" id="exerciseSearch" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 pl-10 focus:border-purple-500 focus:outline-none" placeholder="Search exercises...">
                            <i class="fas fa-search absolute left-3 top-3.5 text-gray-500"></i>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="exercise-library"></div>
                    <div class="mt-8">
                        <h3 class="text-lg font-bold mb-4">Add Custom Exercise</h3>
                        <div class="flex space-x-3">
                            <input type="text" id="customExerciseName" class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none" placeholder="Exercise name">
                            <button id="addCustomExercise" class="btn-hunter px-4 py-2 rounded-lg">
                                Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Level Up Notification -->
        <div id="levelUpModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-overlay">
            <div class="hunter-card w-full max-w-md relative text-center glow modal-content">
                <div class="hunter-header">
                    <h2 class="text-2xl font-bold"><i class="fas fa-level-up-alt mr-2"></i> LEVEL UP!</h2>
                </div>
                <div class="p-8">
                    <div class="text-6xl mb-4 text-purple-400">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">You are now Level <span id="new-level">2</span></h3>
                    <p class="text-gray-300 mb-4">Your power grows stronger!</p>
                    <button id="closeLevelUp" class="btn-hunter px-6 py-2 rounded-lg">
                        Continue Training
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Power Up Notification -->
        <div id="powerUpModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-overlay">
            <div class="hunter-card w-full max-w-md relative text-center glow modal-content">
                <div class="hunter-header">
                    <h2 class="text-2xl font-bold"><i class="fas fa-bolt mr-2"></i> POWER UNLOCKED!</h2>
                </div>
                <div class="p-8">
                    <div class="text-6xl mb-4" id="power-icon">
                        <i class="fas fa-flask text-purple-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2"><span id="power-name">Shadow Extraction</span> Level <span id="power-level">1</span></h3>
                    <p class="text-gray-300 mb-4" id="power-description">You can now convert defeated enemies to shadows</p>
                    <button id="closePowerUp" class="btn-hunter px-6 py-2 rounded-lg">
                        Acknowledge
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Professional RGB Flowing Footer -->
    <footer id="main-footer" class="fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-sm shadow-2xl z-40 rgb-border">
        <div class="max-w-6xl mx-auto px-6 py-5">
            <!-- Top Row - Copyright and Social Links -->
            <div class="flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0 mb-2 md:mb-3">
                <!-- Copyright -->
                <div class="text-white/80 text-xs md:text-sm text-center md:text-left">
                    <span class="font-bold">© 2024 Shadow Monarch's Training System</span>
                    <span class="hidden md:inline mx-2">•</span>
                    <span class="hidden md:inline">All rights reserved</span>
                </div>
                
                <!-- Social Links -->
                <div class="flex items-center justify-center md:justify-start space-x-4 md:space-x-5">
                    <a href="https://www.linkedin.com/in/usman-shariff0514/" target="_blank" class="text-white/80 hover:text-blue-300 transition-colors duration-300 group" title="LinkedIn">
                        <i class="fab fa-linkedin text-lg md:text-xl group-hover:scale-110 transition-transform duration-300"></i>
                    </a>
                    <a href="https://github.com/Usmansha05/" target="_blank" class="text-white/80 hover:text-gray-300 transition-colors duration-300 group" title="GitHub">
                        <i class="fab fa-github text-lg md:text-xl group-hover:scale-110 transition-transform duration-300"></i>
                    </a>
                    <a href="mailto:usmanshariff200205@gmail.com" class="text-white/80 hover:text-red-300 transition-colors duration-300 group" title="Email">
                        <i class="fas fa-envelope text-lg md:text-xl group-hover:scale-110 transition-transform duration-300"></i>
                    </a>
                </div>
            </div>
            
            <!-- Bottom Row - Credits and Developer Info -->
            <div class="flex flex-col md:flex-row justify-between items-center space-y-1 md:space-y-0">
                <!-- Credits -->
                <div class="text-white/70 text-xs md:text-sm text-center md:text-left">
                    <span>Inspired by</span>
                    <a href="https://en.wikipedia.org/wiki/Solo_Leveling" target="_blank" class="text-purple-300 hover:text-purple-200 mx-1 font-semibold">Solo Leveling</a>
                    <span>by</span>
                    <span class="font-semibold mx-1">Chugong</span>
                </div>
                
                <!-- Developer Info -->
                <div class="text-white/70 text-xs md:text-sm text-center md:text-left">
                    <span>Developed by</span>
                    <a href="https://www.linkedin.com/in/usman-shariff0514/" target="_blank" class="text-blue-300 hover:text-blue-200 mx-1 font-bold">Shariff Usman</a>
                    <span class="hidden md:inline mx-2">•</span>
                    <span class="hidden md:inline">Made with</span>
                    <span class="text-red-400 mx-1">❤️</span>
                    <span class="hidden md:inline">and lots of</span>
                    <span class="text-yellow-400 mx-1">☕</span>
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        // Game State
        const state = {
            level: 1,
            xp: 0,
            maxXp: 100,
            stats: {
                str: 1,
                agi: 1,
                end: 1
            },
            powers: {
                extraction: { level: 0, xp: 0, maxXp: 50 },
                speed: { level: 0, xp: 0, maxXp: 50 },
                domain: { level: 0, xp: 0, maxXp: 50 },
                authority: { level: 0, xp: 0, maxXp: 50 }
            },
            streak: 1,
            lastActiveDate: new Date().toDateString(),
            quests: [],
            exercises: [
                { id: 1, name: "Shadow Squats", type: "Legs", description: "Bodyweight squats with perfect form" },
                { id: 2, name: "Gate Push-ups", type: "Chest", description: "Standard push-ups with controlled motion" },
                { id: 3, name: "Mana Circulation", type: "Flexibility", description: "Deep stretching routine" },
                { id: 4, name: "Dungeon Run", type: "Cardio", description: "Outdoor running with intervals" },
                { id: 5, name: "Shadow Lunges", type: "Legs", description: "Alternating forward lunges" },
                { id: 6, name: "Monarch Plank", type: "Core", description: "Hold plank position" },
                { id: 7, name: "Hunter Pull-ups", type: "Back", description: "Overhand grip pull-ups" },
                { id: 8, name: "Army Training", type: "Full Body", description: "Circuit training" }
            ],
            user: {
                name: "Hunter",
                avatar: "https://i.imgur.com/Jz5ZQYt.jpg",
                bgVideo: "1"
            }
        };

        // Quest Types
        const questTypes = {
            main: { name: "Main Quest", color: "bg-purple-600", icon: "fa-crosshairs" },
            side: { name: "Side Quest", color: "bg-yellow-600", icon: "fa-compass" },
            emergency: { name: "Emergency Quest", color: "bg-red-600", icon: "fa-skull" }
        };

        // Power Details
        const powerDetails = {
            extraction: {
                name: "Shadow Extraction",
                description: "Convert defeated enemies to shadows",
                icon: "fa-flask",
                color: "text-purple-400"
            },
            speed: {
                name: "Dominator's Speed",
                description: "Enhanced movement and reflexes",
                icon: "fa-running",
                color: "text-green-400"
            },
            domain: {
                name: "Monarch's Domain",
                description: "Area control and defense",
                icon: "fa-shield-alt",
                color: "text-blue-400"
            },
            authority: {
                name: "Ruler's Authority",
                description: "Command over shadows",
                icon: "fa-fist-raised",
                color: "text-red-400"
            }
        };

        // Background Videos
        const bgVideos = {
            "1": "https://assets.mixkit.co/videos/preview/mixkit-digital-animation-of-a-woman-training-with-a-sword-39739-large.mp4",
            "2": "https://assets.mixkit.co/videos/preview/mixkit-mystical-forest-4273-large.mp4",
            "3": "https://assets.mixkit.co/videos/preview/mixkit-dark-clouds-over-a-mountain-39700-large.mp4"
        };
        
        // Solo Leveling System Messages
        const systemMessages = [
            "Welcome to the Shadow Monarch's Training System",
            "Your journey to become the strongest begins now",
            "The System has detected your presence",
            "Shadow Extraction protocol initialized",
            "Dominator's Authority system online",
            "Monarch's Domain ready for activation"
        ];
        
        // Fallback background video (local file if available)
        const fallbackVideo = "slbgm.mp4";
        

        // Avatar Options
        const avatarOptions = {
            "1": "https://i.imgur.com/Jz5ZQYt.jpg",
            "2": "https://i.imgur.com/8Km9tLL.jpg",
            "3": "https://i.imgur.com/5QZ9Z1Q.jpg",
            "4": "https://i.imgur.com/7QZ9Z1Q.jpg",
            "5": "https://i.imgur.com/9QZ9Z1Q.jpg",
            "6": "https://i.imgur.com/0QZ9Z1Q.jpg"
        };

        // Default Daily Quests
        const defaultQuests = [
            { type: "main", name: "Shadow Squats", description: "4 sets x 15 reps", xp: 100, power: "extraction" },
            { type: "main", name: "Gate Push-ups", description: "3 sets x 20 reps", xp: 80, power: "speed" },
            { type: "side", name: "Mana Circulation", description: "15 min stretching", xp: 50, power: "domain" },
            { type: "emergency", name: "Dungeon Run", description: "5K in 30 min", xp: 150, power: "authority" }
        ];

        // DOM Elements
        const customizationModal = document.getElementById('customizationModal');
        const landingPage = document.getElementById('landing-page');
        const trainingSystem = document.getElementById('training-system');
        const beginHuntBtn = document.getElementById('begin-hunt');
        const questsContainer = document.getElementById('quests-container');
        const exercisePreview = document.getElementById('exercise-preview');
        const exerciseLibrary = document.getElementById('exercise-library');
        const questModal = document.getElementById('questModal');
        const exerciseModal = document.getElementById('exerciseModal');
        const levelUpModal = document.getElementById('levelUpModal');
        const powerUpModal = document.getElementById('powerUpModal');
        const openQuestModalBtn = document.getElementById('openQuestModal');
        const closeQuestModalBtn = document.getElementById('closeQuestModal');
        const cancelQuestBtn = document.getElementById('cancelQuest');
        const saveQuestBtn = document.getElementById('saveQuest');
        const openExerciseModalBtn = document.getElementById('openExerciseModal');
        const closeExerciseModalBtn = document.getElementById('closeExerciseModal');
        const addCustomExerciseBtn = document.getElementById('addCustomExercise');
        const exerciseSearch = document.getElementById('exerciseSearch');
        const closeLevelUpBtn = document.getElementById('closeLevelUp');
        const closePowerUpBtn = document.getElementById('closePowerUp');
        const resetDailyBtn = document.getElementById('reset-daily');
        const missionInput = document.getElementById('mission-input');
        const addMissionBtn = document.getElementById('add-mission');
        const missionList = document.getElementById('mission-list');
        const activeMissionsCount = document.getElementById('active-missions-count');
        const completedMissionsCount = document.getElementById('completed-missions-count');
        const clearMissionsBtn = document.getElementById('clear-missions');
        const saveMissionsBtn = document.getElementById('save-missions');
        const questCompleteSound = document.getElementById('quest-complete-sound');
        const levelUpSound = document.getElementById('level-up-sound');
        const powerUpSound = document.getElementById('power-up-sound');
        const hunterNameInput = document.getElementById('hunterNameInput');
        const resetProgressBtn = document.getElementById('resetProgress');
        const deleteUserBtn = document.getElementById('deleteUser');
        const registerHunterBtn = document.getElementById('register-hunter');
        const closeCustomizationModalBtn = document.getElementById('closeCustomizationModal');
        const signOutBtn = document.getElementById('signOutBtn');
        const userSelectionModal = document.getElementById('userSelectionModal');
        const closeUserSelectionModalBtn = document.getElementById('closeUserSelectionModal');
        const registeredUsersList = document.getElementById('registeredUsersList');
        const registerNewUserBtn = document.getElementById('registerNewUserBtn');
        const cancelUserSelectionBtn = document.getElementById('cancelUserSelection');
        const avatarOptionsContainer = document.querySelector('.avatar-grid');
        const avatarUpload = document.getElementById('avatarUpload');
        const bgSelect = document.getElementById('bgSelect');
        const bgUpload = document.getElementById('bgUpload');
        const bgUploadContainer = document.getElementById('bgUploadContainer');
        const saveCustomizationBtn = document.getElementById('saveCustomization');
        const openCustomizationBtn = document.getElementById('openCustomization');
        const bgVideoElement = document.getElementById('bg-video');
        const userAvatar = document.getElementById('user-avatar');
        const hunterNameDisplay = document.getElementById('hunter-name');
        const realTimeDate = document.getElementById('real-time-date');
        const previewAvatar = document.getElementById('preview-avatar');
        const previewName = document.getElementById('preview-name');
        const videoVolumeBtn = document.getElementById('videoVolumeBtn');

        
        let missions = [];
        let selectedAvatar = "1";
        let customAvatar = null;
        let customBgVideo = null;



        
        // Real-Time Date Display
        function updateDateTime() {
            try {
                const now = new Date();
                const options = {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZone: 'Asia/Kolkata'
                };
                
                const dateTimeString = now.toLocaleDateString('en-US', options);
                const timeString = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZone: 'Asia/Kolkata'
                });
                
                // Format with better readability
                const formattedDateTime = `${dateTimeString} | ${timeString}`;
                realTimeDate.innerHTML = `<i class="fas fa-clock mr-2 text-purple-400"></i>${formattedDateTime}`;
                
                // Check for date change and reset quests if needed
                checkDateChangeAndReset();
                
                console.log('Date updated:', formattedDateTime);
            } catch (err) {
                console.error('Error updating date:', err);
            }
        }
        
        // Show system message
        function showSystemMessage(message, duration = 3000, type = 'info') {
            try {
                const messageDiv = document.createElement('div');
                let bgColor = 'bg-gray-900/90 border-purple-500';
                let icon = 'fa-terminal';
                
                if (type === 'success') {
                    bgColor = 'bg-green-900/90 border-green-500';
                    icon = 'fa-check-circle';
                } else if (type === 'warning') {
                    bgColor = 'bg-yellow-900/90 border-yellow-500';
                    icon = 'fa-exclamation-triangle';
                } else if (type === 'date-change') {
                    bgColor = 'bg-blue-900/90 border-blue-500';
                    icon = 'fa-calendar-day';
                }
                
                messageDiv.className = `fixed top-20 left-1/2 transform -translate-x-1/2 ${bgColor} rounded-lg px-6 py-3 text-white font-bold hunter-font z-50 animate-pulse`;
                messageDiv.innerHTML = `<i class="fas ${icon} mr-2"></i> ${message}`;
                document.body.appendChild(messageDiv);
                
                // Add pulse animation for date changes
                if (type === 'date-change') {
                    messageDiv.classList.add('date-pulse');
                }
                
                setTimeout(() => {
                    messageDiv.remove();
                }, duration);
                console.log('System message shown:', message);
            } catch (err) {
                console.error('Error showing system message:', err);
            }
        }
        setInterval(updateDateTime, 1000);
        updateDateTime();
        


        // Initialize the app
        function init() {
            try {
                loadState();
                setupEventListeners();
                
                // Test video file
                const video = document.getElementById('bg-video');
                if (video) {
                    console.log('Video element found');
                    console.log('Video src:', video.src);
                    console.log('Video readyState:', video.readyState);
                } else {
                    console.error('Video element not found');
                }
                
                // Check if user exists and show appropriate page
                const users = getRegisteredUsers();
                console.log('Users found on init:', users.length);
                
                // Always show landing page first
                landingPage.classList.remove('hidden');
                trainingSystem.classList.add('hidden');
                if (video) {
                    video.style.display = 'block';
                    video.style.visibility = 'visible';
                    video.style.opacity = '1';
                    video.style.zIndex = '-2';
                }
                
                // Hide sign out button
                signOutBtn.classList.add('hidden');
                
                if (users.length > 0) {
                    console.log('Showing landing page with', users.length, 'registered users');
                    showSystemMessage(`Found ${users.length} registered user${users.length !== 1 ? 's' : ''}`, 2000, 'info');
                } else {
                    console.log('Showing landing page with no registered users');
                    showSystemMessage("Welcome! Please register your first account", 3000, 'info');
                }
                
                // Initialize video after a short delay to ensure DOM is ready
                setTimeout(() => {
                    ensureVideoPlays();
                }, 100);
                
                // Update footer visibility
                updateFooterVisibility();
                
                // Show welcome message
                setTimeout(() => {
                    showSystemMessage(systemMessages[Math.floor(Math.random() * systemMessages.length)]);
                }, 500);
                
                console.log('App initialized successfully');
            } catch (err) {
                console.error('Error initializing app:', err);
            }
        }

        // Load state from localStorage
        function loadState() {
            try {
                // Reset state to default for landing page
                state.userId = null;
                state.user = {
                    name: "Hunter",
                    avatar: "https://i.imgur.com/Jz5ZQYt.jpg",
                    bgVideo: "1"
                };
                
                // Load quests if they don't exist
                if (!state.quests || state.quests.length === 0) {
                    state.quests = defaultQuests.map((q, i) => ({
                        id: i + 1,
                        type: q.type,
                        name: q.name,
                        description: q.description,
                        xp: q.xp,
                        power: q.power,
                        completed: false
                    }));
                }
                
                // Use bgv.mp4 for landing page video background
                bgVideoElement.src = "bgv.mp4";
                console.log('Video source set to:', bgVideoElement.src);
                
                console.log('State loaded for landing page');
            } catch (err) {
                console.error('Error loading state:', err);
            }
        }

        // Save state to localStorage
        function saveState() {
            try {
                // Validate state before saving
                if (!state || typeof state !== 'object') {
                    throw new Error('Invalid state object');
                }
                
                // Generate unique ID for new users
                if (!state.userId) {
                    state.userId = 'hunterTrainingState_' + Date.now();
                }
                
                // Ensure user object exists
                if (!state.user) {
                    state.user = {
                        name: "Hunter",
                        avatar: "https://i.imgur.com/Jz5ZQYt.jpg",
                        bgVideo: "1"
                    };
                }
                
                // Validate required fields
                const requiredFields = ['level', 'xp', 'maxXp', 'stats', 'powers', 'streak', 'quests'];
                for (const field of requiredFields) {
                    if (!(field in state)) {
                        console.warn(`Missing required field: ${field}`);
                    }
                }
                
                const stateJson = JSON.stringify(state);
                if (!stateJson) {
                    throw new Error('Failed to stringify state');
                }
                
                localStorage.setItem(state.userId, stateJson);
                
                // Also save to main state for backward compatibility
                localStorage.setItem('hunterTrainingState', stateJson);
                
                console.log('State saved with ID:', state.userId);
                console.log('User name saved:', state.user.name);
            } catch (err) {
                console.error('Error saving state:', err);
                showSystemMessage("Error saving progress. Please try again.", 3000, 'warning');
            }
        }
        
        // Debug function to show all localStorage data
        function debugLocalStorage() {
            try {
                console.log('=== DEBUG: All localStorage data ===');
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    try {
                        const data = localStorage.getItem(key);
                        const parsed = JSON.parse(data);
                        if (parsed && parsed.user) {
                            console.log(`Key: ${key}`);
                            console.log(`User: ${parsed.user.name}`);
                            console.log(`Level: ${parsed.level || 1}`);
                            console.log('---');
                        }
                    } catch (err) {
                        console.log(`Key: ${key} (not JSON)`);
                    }
                });
                console.log('=== END DEBUG ===');
            } catch (err) {
                console.error('Error debugging localStorage:', err);
            }
        }
        
        // Validate and repair user data
        function validateAndRepairUserData(userData) {
            try {
                if (!userData || typeof userData !== 'object') {
                    return null;
                }
                
                // Ensure all required fields exist
                const defaultData = {
                    level: 1,
                    xp: 0,
                    maxXp: 100,
                    stats: { str: 1, agi: 1, end: 1 },
                    powers: {
                        extraction: { level: 0, xp: 0, maxXp: 50 },
                        speed: { level: 0, xp: 0, maxXp: 50 },
                        domain: { level: 0, xp: 0, maxXp: 50 },
                        authority: { level: 0, xp: 0, maxXp: 50 }
                    },
                    streak: 1,
                    lastActiveDate: new Date().toDateString(),
                    quests: defaultQuests.map((q, i) => ({
                        id: i + 1,
                        type: q.type,
                        name: q.name,
                        description: q.description,
                        xp: q.xp,
                        power: q.power,
                        completed: false
                    })),
                    user: {
                        name: "Hunter",
                        avatar: "https://i.imgur.com/Jz5ZQYt.jpg",
                        bgVideo: "1"
                    }
                };
                
                // Merge with defaults for missing fields
                const repairedData = { ...defaultData, ...userData };
                
                // Validate numeric fields
                if (typeof repairedData.level !== 'number' || repairedData.level < 1) {
                    repairedData.level = 1;
                }
                if (typeof repairedData.xp !== 'number' || repairedData.xp < 0) {
                    repairedData.xp = 0;
                }
                if (typeof repairedData.maxXp !== 'number' || repairedData.maxXp < 100) {
                    repairedData.maxXp = 100;
                }
                if (typeof repairedData.streak !== 'number' || repairedData.streak < 1) {
                    repairedData.streak = 1;
                }
                
                // Validate stats
                if (!repairedData.stats || typeof repairedData.stats !== 'object') {
                    repairedData.stats = { str: 1, agi: 1, end: 1 };
                }
                
                // Validate powers
                if (!repairedData.powers || typeof repairedData.powers !== 'object') {
                    repairedData.powers = {
                        extraction: { level: 0, xp: 0, maxXp: 50 },
                        speed: { level: 0, xp: 0, maxXp: 50 },
                        domain: { level: 0, xp: 0, maxXp: 50 },
                        authority: { level: 0, xp: 0, maxXp: 50 }
                    };
                }
                
                // Validate user object
                if (!repairedData.user || typeof repairedData.user !== 'object') {
                    repairedData.user = {
                        name: "Hunter",
                        avatar: "https://i.imgur.com/Jz5ZQYt.jpg",
                        bgVideo: "1"
                    };
                }
                
                return repairedData;
            } catch (err) {
                console.error('Error validating user data:', err);
                return null;
            }
        }

        // Save user customization
        function saveCustomization() {
            try {
                const customization = {
                    name: state.user.name,
                    avatar: state.user.avatar,
                    bgVideo: state.user.bgVideo,
                    customAvatar: customAvatar,
                    customBgVideo: customBgVideo
                };
                localStorage.setItem('hunterCustomization', JSON.stringify(customization));
                console.log('Customization saved:', customization);
            } catch (err) {
                console.error('Error saving customization:', err);
            }
        }

        // Update footer visibility based on current page
        function updateFooterVisibility() {
            try {
                const footer = document.getElementById('main-footer');
                if (!footer) return;
                if (trainingSystem.classList.contains('hidden')) {
                    // On landing page
                    footer.style.display = 'block';
                } else {
                    // On main content page
                    footer.style.display = 'none';
                }
            } catch (err) {
                console.error('Error updating footer visibility:', err);
            }
        }
        
        // Ensure video plays (only on landing page)
        function ensureVideoPlays() {
            try {
                const video = document.getElementById('bg-video');
                if (!video) {
                    console.error('Video element not found');
                    return;
                }
                
                // Always show video on landing page, hide on training system
                if (trainingSystem.classList.contains('hidden')) {
                    // Landing page - show video
                    video.style.display = 'block';
                    video.style.visibility = 'visible';
                    video.style.opacity = '1';
                    video.style.zIndex = '-2';
                    
                    // Set video attributes for audio playback
                    video.muted = false; // Allow audio
                    video.volume = 0.3; // Set volume to 30%
                    video.loop = true;
                    video.playsInline = true;
                    video.autoplay = true;
                    
                    console.log('Video should be visible on landing page');
                    
                    // Try to play the video with audio
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('Background video with audio started playing');
                        }).catch(err => {
                            console.warn('Video autoplay failed:', err);
                            // Try again after user interaction
                            document.addEventListener('click', () => {
                                video.play().catch(e => console.warn('Video play failed:', e));
                            }, { once: true });
                        });
                    }
                } else {
                    // Training system - hide video
                    video.style.display = 'none';
                    video.style.visibility = 'hidden';
                    video.style.opacity = '0';
                    console.log('Video hidden on training system');
                }
                
                // Handle video errors
                video.addEventListener('error', (e) => {
                    console.error('Video error:', e);
                    console.log('Please make sure "bgv.mp4" is in the same folder as slp.html');
                });
                
                // Handle video load
                video.addEventListener('loadeddata', () => {
                    console.log('Video with audio loaded successfully');
                });
                
                // Handle audio load
                video.addEventListener('canplaythrough', () => {
                    console.log('Video audio ready to play');
                });
            } catch (err) {
                console.error('Error ensuring video plays:', err);
            }
        }

        // Update preview display
        function updatePreview() {
            try {
                const name = hunterNameInput.value.trim() || 'Hunter';
                previewName.textContent = name;
                previewAvatar.src = state.user.avatar;
                console.log('Preview updated:', name);
            } catch (err) {
                console.error('Error updating preview:', err);
            }
        }

        // Video volume control
        let isVideoMuted = false;
        
        function toggleVideoAudio() {
            try {
                const video = document.getElementById('bg-video');
                if (video) {
                    isVideoMuted = !isVideoMuted;
                    video.muted = isVideoMuted;
                    
                    if (isVideoMuted) {
                        videoVolumeBtn.innerHTML = '<i class="fas fa-volume-mute mr-1"></i> Muted';
                        videoVolumeBtn.className = 'fixed bottom-4 left-4 bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded-lg text-sm font-bold transition-colors z-50';
                    } else {
                        videoVolumeBtn.innerHTML = '<i class="fas fa-volume-up mr-1"></i> Audio';
                        videoVolumeBtn.className = 'fixed bottom-4 left-4 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm font-bold transition-colors z-50';
                    }
                    
                    console.log('Video audio toggled:', isVideoMuted ? 'muted' : 'unmuted');
                }
            } catch (err) {
                console.error('Error toggling video audio:', err);
            }
        }
        
        // Update training system background
        function updateTrainingSystemBackground() {
            try {
                const trainingSystemEl = document.getElementById('training-system');
                if (trainingSystemEl) {
                    const bgValue = state.user.bgVideo;
                    let backgroundImage;
                    
                    if (bgValue >= '1' && bgValue <= '6') {
                        backgroundImage = `${bgValue}.jpg`;
                    } else if (bgValue === 'custom' && customBgVideo) {
                        backgroundImage = customBgVideo;
                    } else {
                        // Fallback to the solo leveling image
                        backgroundImage = 'solo-leveling-statue-of-god-grin-smile-2k-wallpaper-uhdpaper.com-150@5@d.jpg';
                    }
                    
                    trainingSystemEl.style.backgroundImage = `url('${backgroundImage}')`;
                    console.log('Training system background updated to:', backgroundImage);
                }
            } catch (err) {
                console.error('Error updating training system background:', err);
            }
        }
        
        // Update user display
        function updateUserDisplay() {
            try {
                hunterNameDisplay.textContent = state.user.name;
                userAvatar.src = state.user.avatar;
                console.log('User display updated:', state.user);
            } catch (err) {
                console.error('Error updating user display:', err);
            }
        }

        // Check if we need to reset daily quests
        function checkDailyReset() {
            try {
                const today = new Date().toDateString();
                if (state.lastActiveDate !== today) {
                    const hadCompleted = state.quests.some(q => q.completed);
                    state.quests.forEach(q => q.completed = false);
                    state.streak = hadCompleted ? state.streak + 1 : 1;
                    state.lastActiveDate = today;
                    saveState();
                    renderQuests();
                    updateStatsDisplay();
                    console.log(`Daily reset performed. New streak: ${state.streak}`);
                } else {
                    console.log('No reset needed; same day:', today);
                }
            } catch (err) {
                console.error('Error checking daily reset:', err);
            }
        }
        
        // Check for date change and reset quests automatically
        function checkDateChangeAndReset() {
            try {
                const today = new Date().toDateString();
                if (state.lastActiveDate && state.lastActiveDate !== today) {
                    const hadCompleted = state.quests.some(q => q.completed);
                    const completedCount = state.quests.filter(q => q.completed).length;
                    
                    // Reset all quests
                    state.quests.forEach(q => q.completed = false);
                    
                    // Update streak
                    if (hadCompleted) {
                        state.streak++;
                        showSystemMessage(`🔥 New Day! Streak: ${state.streak} days | Quests Reset`, 5000, 'date-change');
                    } else {
                        state.streak = 1;
                        showSystemMessage(`📅 New Day! Starting fresh | Quests Reset`, 5000, 'date-change');
                    }
                    
                    state.lastActiveDate = today;
                    saveState();
                    renderQuests();
                    updateStatsDisplay();
                    
                    // Show level up animation for streak
                    if (state.streak > 1) {
                        const streakElement = document.getElementById('streak-counter');
                        if (streakElement) {
                            streakElement.classList.add('level-up');
                            setTimeout(() => streakElement.classList.remove('level-up'), 700);
                        }
                    }
                    
                    console.log(`Real-time daily reset: ${completedCount} quests completed yesterday, new streak: ${state.streak}`);
                }
            } catch (err) {
                console.error('Error checking date change:', err);
            }
        }

        // Reset daily quests manually
        function resetDailyQuests() {
            try {
                if (confirm("Reset all daily quests? This will clear your progress for today.")) {
                    state.quests.forEach(q => q.completed = false);
                    state.lastActiveDate = new Date().toDateString();
                    state.streak = 1;
                    saveState();
                    renderQuests();
                    updateStatsDisplay();
                    console.log('Daily quests reset');
                }
            } catch (err) {
                console.error('Error resetting daily quests:', err);
            }
        }
        
        // Reset all progress
        function resetAllProgress() {
            try {
                if (confirm("Are you sure you want to reset ALL progress? This will delete your level, XP, stats, and quests. This action cannot be undone.")) {
                    // Reset to initial state
                    state.level = 1;
                    state.xp = 0;
                    state.maxXp = 100;
                    state.stats = { str: 1, agi: 1, end: 1 };
                    state.powers = {
                        extraction: { level: 0, xp: 0, maxXp: 50 },
                        speed: { level: 0, xp: 0, maxXp: 50 },
                        domain: { level: 0, xp: 0, maxXp: 50 },
                        authority: { level: 0, xp: 0, maxXp: 50 }
                    };
                    state.streak = 1;
                    state.lastActiveDate = new Date().toDateString();
                    state.quests = defaultQuests.map((q, i) => ({
                        id: i + 1,
                        type: q.type,
                        name: q.name,
                        description: q.description,
                        xp: q.xp,
                        power: q.power,
                        completed: false
                    }));
                    
                    // Clear missions
                    missions = [];
                    if (state.userId) {
                        localStorage.removeItem(`shadowMissions_${state.userId}`);
                    } else {
                        localStorage.removeItem('shadowMissions');
                    }
                    
                    saveState();
                    saveMissions();
                    renderQuests();
                    updateStatsDisplay();
                    updatePowersDisplay();
                    renderMissions();
                    showSystemMessage("All Progress Reset - Starting Fresh", 4000, 'warning');
                    console.log('All progress reset');
                }
            } catch (err) {
                console.error('Error resetting all progress:', err);
            }
        }
        
        // Close customization modal
        function closeCustomizationModal() {
            try {
                console.log('closeCustomizationModal called');
                customizationModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                // Always return to landing page when closing modal
                landingPage.classList.remove('hidden');
                trainingSystem.classList.add('hidden');
                const video = document.getElementById('bg-video');
                if (video) {
                    video.style.display = 'block';
                    video.style.visibility = 'visible';
                    video.style.opacity = '1';
                    video.style.zIndex = '-2';
                    
                    // Ensure video plays
                    setTimeout(() => {
                        ensureVideoPlays();
                    }, 100);
                }
                
                // Hide sign out button
                signOutBtn.classList.add('hidden');
                
                // Update footer visibility
                updateFooterVisibility();
                
                console.log('Customization modal closed successfully');
            } catch (err) {
                console.error('Error closing customization modal:', err);
            }
        }
        window.closeCustomizationModal = closeCustomizationModal;
        
                // Get all registered users
        function getRegisteredUsers() {
            try {
                const users = [];
                const keys = Object.keys(localStorage);
                console.log('All localStorage keys:', keys);
                
                // Check for users with timestamp IDs
                keys.forEach(key => {
                    if (key.startsWith('hunterTrainingState_')) {
                        try {
                            const userDataStr = localStorage.getItem(key);
                            if (!userDataStr) return;
                            
                            const userData = JSON.parse(userDataStr);
                            if (userData && userData.user && userData.user.name && 
                                userData.user.name !== 'Hunter' && userData.user.name !== '') {
                                
                                // Validate user data before adding
                                const validatedData = validateAndRepairUserData(userData);
                                if (validatedData) {
                                    users.push({
                                        id: key,
                                        name: validatedData.user.name,
                                        avatar: validatedData.user.avatar,
                                        level: validatedData.level || 1,
                                        rank: getRankFromLevel(validatedData.level || 1)
                                    });
                                    console.log('Found user with ID:', key, validatedData.user.name);
                                }
                            }
                        } catch (err) {
                            console.error('Error parsing user data for key:', key, err);
                            // Try to clean up corrupted data
                            try {
                                localStorage.removeItem(key);
                                console.log('Removed corrupted user data for key:', key);
                            } catch (cleanupErr) {
                                console.error('Error cleaning up corrupted data:', cleanupErr);
                            }
                        }
                    }
                });
                
                // Also check for the main user (without suffix)
                const mainUserData = localStorage.getItem('hunterTrainingState');
                if (mainUserData) {
                    try {
                        const userData = JSON.parse(mainUserData);
                        if (userData && userData.user && userData.user.name && 
                            userData.user.name !== 'Hunter' && userData.user.name !== '') {
                            
                            // Validate user data before adding
                            const validatedData = validateAndRepairUserData(userData);
                            if (validatedData) {
                                users.push({
                                    id: 'hunterTrainingState',
                                    name: validatedData.user.name,
                                    avatar: validatedData.user.avatar,
                                    level: validatedData.level || 1,
                                    rank: getRankFromLevel(validatedData.level || 1)
                                });
                                console.log('Found main user:', validatedData.user.name);
                            }
                        }
                    } catch (err) {
                        console.error('Error parsing main user data:', err);
                        // Try to clean up corrupted data
                        try {
                            localStorage.removeItem('hunterTrainingState');
                            console.log('Removed corrupted main user data');
                        } catch (cleanupErr) {
                            console.error('Error cleaning up corrupted main data:', cleanupErr);
                        }
                    }
                }
                
                // Check for any other potential user data
                keys.forEach(key => {
                    if ((key.includes('hunter') || key.includes('user') || key.includes('state')) && 
                        !key.startsWith('hunterTrainingState_') && key !== 'hunterTrainingState') {
                        try {
                            const userDataStr = localStorage.getItem(key);
                            if (!userDataStr) return;
                            
                            const userData = JSON.parse(userDataStr);
                            if (userData && userData.user && userData.user.name && 
                                userData.user.name !== 'Hunter' && userData.user.name !== '' &&
                                !users.some(u => u.name === userData.user.name)) {
                                
                                // Validate user data before adding
                                const validatedData = validateAndRepairUserData(userData);
                                if (validatedData) {
                                    users.push({
                                        id: key,
                                        name: validatedData.user.name,
                                        avatar: validatedData.user.avatar,
                                        level: validatedData.level || 1,
                                        rank: getRankFromLevel(validatedData.level || 1)
                                    });
                                    console.log('Found additional user with ID:', key, validatedData.user.name);
                                }
                            }
                        } catch (err) {
                            // Ignore parsing errors for non-user data
                            console.debug('Non-user data found in localStorage:', key);
                        }
                    }
                });
                
                // Remove duplicates based on name
                const uniqueUsers = users.filter((user, index, self) => 
                    index === self.findIndex(u => u.name === user.name)
                );
                
                console.log('Total unique users found:', uniqueUsers.length);
                console.log('Users:', uniqueUsers.map(u => u.name));
                return uniqueUsers;
            } catch (err) {
                console.error('Error getting registered users:', err);
                return [];
            }
        }
        
        // Get rank from level
        function getRankFromLevel(level) {
            if (level >= 25) return 'S';
            if (level >= 20) return 'A';
            if (level >= 15) return 'B';
            if (level >= 10) return 'C';
            if (level >= 5) return 'D';
            return 'E';
        }
        
        // Show user selection modal
        function showUserSelectionModal() {
            try {
                console.log('showUserSelectionModal called');
                debugLocalStorage(); // Debug all localStorage data
                const users = getRegisteredUsers();
                console.log('Found users:', users);
                
                if (users.length === 0) {
                    // No users registered, go directly to registration
                    console.log('No users found, going to registration');
                    showSystemMessage("No registered users found - Please register a new account", 3000, 'info');
                    registerHunterBtn.click();
                    return;
                }
                
                registeredUsersList.innerHTML = '';
                
                users.forEach((user, index) => {
                    const userElement = document.createElement('div');
                    userElement.className = 'flex items-center justify-between p-3 bg-gray-800/60 rounded-lg border border-gray-700 hover:bg-gray-700/60 transition cursor-pointer mb-2';
                    userElement.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <img src="${user.avatar}" alt="${user.name}" class="w-10 h-10 rounded-full border-2 border-purple-600/50 object-cover">
                            <div>
                                <div class="font-bold text-white">${user.name}</div>
                                <div class="text-sm text-gray-400">Level ${user.level} • Rank ${user.rank}</div>
                                <div class="text-xs text-gray-500">ID: ${user.id}</div>
                            </div>
                        </div>
                        <button class="select-user-btn btn-hunter px-3 py-1 rounded text-xs" data-user-id="${user.id}">
                            Select
                        </button>
                    `;
                    registeredUsersList.appendChild(userElement);
                });
                
                // Add a message showing total users found
                const userCountElement = document.createElement('div');
                userCountElement.className = 'text-center text-sm text-gray-400 mb-4';
                userCountElement.textContent = `Found ${users.length} registered hunter${users.length !== 1 ? 's' : ''}`;
                registeredUsersList.insertBefore(userCountElement, registeredUsersList.firstChild);
                
                // Ensure modal is visible
                if (userSelectionModal) {
                    userSelectionModal.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                    console.log('User selection modal shown with', users.length, 'users');
                } else {
                    console.error('userSelectionModal element not found');
                }
            } catch (err) {
                console.error('Error showing user selection modal:', err);
            }
        }
        
        // Load user data
        function loadUserData(userId) {
            try {
                console.log('Loading user data for ID:', userId);
                
                if (!userId) {
                    throw new Error('No user ID provided');
                }
                
                const userData = localStorage.getItem(userId);
                if (!userData) {
                    throw new Error(`No user data found for ID: ${userId}`);
                }
                
                let parsedData;
                try {
                    parsedData = JSON.parse(userData);
                } catch (parseError) {
                    throw new Error(`Invalid JSON data for user: ${parseError.message}`);
                }
                
                if (!parsedData || typeof parsedData !== 'object') {
                    throw new Error('Invalid user data structure');
                }
                
                // Validate and repair user data
                const validatedData = validateAndRepairUserData(parsedData);
                if (!validatedData) {
                    throw new Error('Failed to validate user data');
                }
                parsedData = validatedData;
                
                Object.assign(state, parsedData);
                
                // Load missions for this user
                try {
                    const userMissions = localStorage.getItem(`shadowMissions_${userId}`);
                    if (userMissions) {
                        missions = JSON.parse(userMissions);
                        if (!Array.isArray(missions)) {
                            missions = [];
                        }
                    } else {
                        missions = [];
                    }
                } catch (missionError) {
                    console.warn('Error loading missions:', missionError);
                    missions = [];
                }
                
                // Update display
                updateUserDisplay();
                updateStatsDisplay();
                updatePowersDisplay();
                renderQuests();
                renderMissions();
                updateTrainingSystemBackground();
                
                // Show training system
                landingPage.classList.add('hidden');
                trainingSystem.classList.remove('hidden');
                userSelectionModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                // Hide video and show sign out button
                const video = document.getElementById('bg-video');
                if (video) {
                    video.style.display = 'none';
                    video.style.visibility = 'hidden';
                    video.style.opacity = '0';
                }
                signOutBtn.classList.remove('hidden');
                
                // Update footer visibility
                updateFooterVisibility();
                
                showSystemMessage(`Welcome back, ${state.user.name}!`, 3000, 'success');
                console.log('User data loaded successfully:', state.user.name);
            } catch (err) {
                console.error('Error loading user data:', err);
                showSystemMessage(`Error loading user data: ${err.message}`, 4000, 'warning');
                
                // Return to landing page on error
                landingPage.classList.remove('hidden');
                trainingSystem.classList.add('hidden');
                userSelectionModal.classList.add('hidden');
                updateFooterVisibility();
            }
        }
        
        // Sign out function
        function signOut() {
            try {
                if (confirm("Are you sure you want to sign out? Your progress will be saved.")) {
                    saveState();
                    trainingSystem.classList.add('hidden');
                    landingPage.classList.remove('hidden');
                    const video = document.getElementById('bg-video');
                    if (video) {
                        video.style.display = 'block';
                        video.style.visibility = 'visible';
                        video.style.opacity = '1';
                        video.style.zIndex = '-2';
                        setTimeout(() => { ensureVideoPlays(); }, 100);
                    }
                    signOutBtn.classList.add('hidden');
                    updateFooterVisibility();
                    showSystemMessage("Signed Out Successfully - Welcome Back", 3000, 'success');
                    
                    // Reset state to prevent conflicts
                    state.userId = null;
                    state.user = {
                        name: "Hunter",
                        avatar: "https://i.imgur.com/Jz5ZQYt.jpg",
                        bgVideo: "1"
                    };
                }
            } catch (err) {
                console.error('Error signing out:', err);
            }
        }
        
        // Delete user completely
        function deleteUser() {
            try {
                if (confirm("Are you sure you want to DELETE your user account? This will remove all data including profile, progress, and settings. This action cannot be undone.")) {
                    // Only remove the selected user's key
                    if (state.userId) {
                        localStorage.removeItem(state.userId);
                        console.log('Removed user key:', state.userId);
                    }
                    // Remove customization if it matches this user
                    const customization = localStorage.getItem('hunterCustomization');
                    if (customization) {
                        const parsed = JSON.parse(customization);
                        if (parsed && parsed.name === state.user?.name) {
                            localStorage.removeItem('hunterCustomization');
                        }
                    }
                    // Reset state
                    state.level = 1;
                    state.xp = 0;
                    state.maxXp = 100;
                    state.stats = { str: 1, agi: 1, end: 1 };
                    state.powers = {
                        extraction: { level: 0, xp: 0, maxXp: 50 },
                        speed: { level: 0, xp: 0, maxXp: 50 },
                        domain: { level: 0, xp: 0, maxXp: 50 },
                        authority: { level: 0, xp: 0, maxXp: 50 }
                    };
                    state.streak = 1;
                    state.lastActiveDate = new Date().toDateString();
                    state.quests = defaultQuests.map((q, i) => ({
                        id: i + 1,
                        type: q.type,
                        name: q.name,
                        description: q.description,
                        xp: q.xp,
                        power: q.power,
                        completed: false
                    }));
                    state.user = null;
                    state.userId = null;
                    missions = [];
                    // Check for remaining users
                    const users = getRegisteredUsers();
                    if (users.length > 0) {
                        // Show user selection modal
                        showUserSelectionModal();
                        trainingSystem.classList.add('hidden');
                        landingPage.classList.remove('hidden');
                        updateFooterVisibility();
                        showSystemMessage("User deleted. Please select another account.", 4000, 'warning');
                    } else {
                        // No users left, show registration
                        landingPage.classList.remove('hidden');
                        trainingSystem.classList.add('hidden');
                        updateFooterVisibility();
                        showSystemMessage("All User Data Deleted - Please Register New Account", 4000, 'warning');
                    }
                    // Hide sign out button
                    signOutBtn.classList.add('hidden');
                    // Show video on landing page
                    const video = document.getElementById('bg-video');
                    if (video) {
                        video.style.display = 'block';
                        video.style.visibility = 'visible';
                        video.style.opacity = '1';
                        video.style.zIndex = '-2';
                        setTimeout(() => { ensureVideoPlays(); }, 100);
                    }
                }
            } catch (err) {
                console.error('Error deleting user:', err);
            }
        }

        // Render quests
        function renderQuests() {
            try {
                questsContainer.innerHTML = '';
                state.quests.forEach(quest => {
                    const questType = questTypes[quest.type];
                    const questElement = document.createElement('div');
                    questElement.className = `quest-item rounded-lg p-4 ${quest.completed ? 'quest-complete' : ''} ${quest.type === 'emergency' && !quest.completed ? 'emergency-quest' : ''}`;
                    questElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="${questType.color} text-white px-3 py-1 rounded-full text-xs font-bold mr-2">
                                    <i class="fas ${questType.icon} mr-1"></i> ${questType.name}
                                </span>
                                <strong>${quest.name}</strong> - ${quest.description}
                                <div class="text-xs text-gray-400 mt-1">Enhances: ${powerDetails[quest.power].name}</div>
                            </div>
                            <div>
                                <span class="bg-green-600/50 px-2 py-1 rounded-full text-xs font-bold mr-2">${quest.xp} XP</span>
                                <button class="complete-btn ${quest.completed ? 'bg-gray-700 text-gray-400 cursor-not-allowed' : quest.type === 'emergency' ? 'btn-accent' : 'btn-hunter'} px-3 py-1 rounded-lg text-sm" 
                                        data-id="${quest.id}" ${quest.completed ? 'disabled' : ''}>
                                    ${quest.completed ? '<i class="fas fa-check mr-1"></i> CLEARED' : quest.type === 'emergency' ? '<i class="fas fa-skull mr-1"></i> ACCEPT' : '<i class="fas fa-check mr-1"></i> COMPLETE'}
                                </button>
                            </div>
                        </div>
                    `;
                    questsContainer.appendChild(questElement);
                });
                console.log('Quests rendered:', state.quests);
            } catch (err) {
                console.error('Error rendering quests:', err);
            }
        }

        // Render exercise preview
        function renderExercisePreview() {
            try {
                exercisePreview.innerHTML = '';
                state.exercises.slice(0, 6).forEach(exercise => {
                    const exerciseElement = document.createElement('div');
                    exerciseElement.className = 'exercise-card rounded-lg p-4 cursor-pointer';
                    exerciseElement.innerHTML = `
                        <div class="flex items-start">
                            <div class="bg-purple-600/20 p-3 rounded-lg mr-4">
                                <i class="fas fa-dumbbell text-purple-400"></i>
                            </div>
                            <div>
                                <h3 class="font-bold">${exercise.name}</h3>
                                <p class="text-sm text-gray-400">${exercise.type}</p>
                                <p class="text-xs text-gray-500 mt-1">${exercise.description}</p>
                            </div>
                        </div>
                    `;
                    exerciseElement.addEventListener('click', () => {
                        document.getElementById('questName').value = exercise.name;
                        document.getElementById('questDescription').value = exercise.description;
                        questModal.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                    });
                    exercisePreview.appendChild(exerciseElement);
                });
                console.log('Exercise preview rendered');
            } catch (err) {
                console.error('Error rendering exercise preview:', err);
            }
        }

        // Render full exercise library
        function renderExerciseLibrary(searchTerm = '') {
            try {
                exerciseLibrary.innerHTML = '';
                const filteredExercises = state.exercises.filter(exercise => 
                    exercise.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                    exercise.type.toLowerCase().includes(searchTerm.toLowerCase())
                );
                if (filteredExercises.length === 0) {
                    exerciseLibrary.innerHTML = '<div class="col-span-3 text-center py-8 text-gray-500">No exercises found</div>';
                    return;
                }
                filteredExercises.forEach(exercise => {
                    const exerciseElement = document.createElement('div');
                    exerciseElement.className = 'exercise-card rounded-lg p-4 cursor-pointer';
                    exerciseElement.innerHTML = `
                        <div class="flex items-start">
                            <div class="bg-purple-600/20 p-3 rounded-lg mr-4">
                                <i class="fas fa-dumbbell text-purple-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold">${exercise.name}</h3>
                                    <span class="text-xs bg-gray-700 px-2 py-1 rounded">${exercise.type}</span>
                                </div>
                                <p class="text-sm text-gray-400 mt-1">${exercise.description}</p>
                                <button class="select-exercise mt-3 text-xs btn-hunter px-3 py-1 rounded-lg" data-id="${exercise.id}">
                                    Select for Quest
                                </button>
                            </div>
                        </div>
                    `;
                    exerciseLibrary.appendChild(exerciseElement);
                });
                console.log('Exercise library rendered with search:', searchTerm);
            } catch (err) {
                console.error('Error rendering exercise library:', err);
            }
        }

        // Update stats display
        function updateStatsDisplay() {
            try {
                document.getElementById('hunter-level').textContent = `LV ${state.level}`;
                document.getElementById('current-xp').textContent = state.xp;
                document.getElementById('max-xp').textContent = state.maxXp;
                document.getElementById('xp-progress-bar').style.width = `${(state.xp / state.maxXp) * 100}%`;
                document.getElementById('str-stat').querySelector('.text-2xl').textContent = state.stats.str;
                document.getElementById('agi-stat').querySelector('.text-2xl').textContent = state.stats.agi;
                document.getElementById('end-stat').querySelector('.text-2xl').textContent = state.stats.end;
                
                let title = "Novice Hunter";
                let rank = "E";
                if (state.level >= 5) { title = "Experienced Hunter"; rank = "D"; }
                if (state.level >= 10) { title = "Skilled Hunter"; rank = "C"; }
                if (state.level >= 15) { title = "Elite Hunter"; rank = "B"; }
                if (state.level >= 20) { title = "Master Hunter"; rank = "A"; }
                if (state.level >= 25) { title = "Shadow Monarch"; rank = "S"; }
                document.getElementById('hunter-title').textContent = title;
                document.getElementById('hunter-rank').textContent = rank;
                document.getElementById('streak-days').textContent = state.streak;
                console.log('Stats updated:', state);
            } catch (err) {
                console.error('Error updating stats display:', err);
            }
        }

        // Update powers display
        function updatePowersDisplay() {
            try {
                Object.keys(state.powers).forEach(power => {
                    const powerData = state.powers[power];
                    document.querySelectorAll(`.power-level[data-power="${power}"]`).forEach(el => {
                        el.textContent = powerData.level;
                    });
                    document.querySelectorAll(`.power-progress-bar[data-power="${power}"]`).forEach(el => {
                        el.style.width = `${(powerData.xp / powerData.maxXp) * 100}%`;
                    });
                });
                console.log('Powers updated:', state.powers);
            } catch (err) {
                console.error('Error updating powers display:', err);
            }
        }

        // Complete a quest
        function completeQuest(questId) {
            try {
                const questIndex = state.quests.findIndex(q => q.id === questId);
                if (questIndex === -1 || state.quests[questIndex].completed) {
                    console.warn(`Quest ${questId} not found or already completed`);
                    return;
                }
                
                const quest = state.quests[questIndex];
                quest.completed = true;
                state.xp += quest.xp;
                const powerXpGain = Math.floor(quest.xp * 0.5);
                state.powers[quest.power].xp += powerXpGain;
                
                questCompleteSound.play().catch(err => console.error('Audio playback failed:', err));
                showSystemMessage(`Quest Completed: ${quest.name} - +${quest.xp} XP`);
                checkLevelUp();
                checkPowerLevelUp(quest.power);
                saveState();
                renderQuests();
                updateStatsDisplay();
                updatePowersDisplay();
                console.log(`Completed quest ${quest.name}, gained ${quest.xp} XP and ${powerXpGain} power XP for ${quest.power}`);
            } catch (err) {
                console.error('Error completing quest:', err);
            }
        }

        // Check if player leveled up
        function checkLevelUp() {
            try {
                while (state.xp >= state.maxXp) {
                    state.level++;
                    state.xp -= state.maxXp;
                    state.maxXp = Math.floor(state.maxXp * 1.2);
                    state.stats.str += Math.floor(Math.random() * 2) + 1;
                    state.stats.agi += Math.floor(Math.random() * 2) + 1;
                    state.stats.end += Math.floor(Math.random() * 2) + 1;
                    showLevelUpModal();
                    levelUpSound.play().catch(err => console.error('Level up sound failed:', err));
                    console.log(`Leveled up to ${state.level}! New max XP: ${state.maxXp}`);
                }
                saveState();
                updateStatsDisplay();
            } catch (err) {
                console.error('Error checking level up:', err);
            }
        }

        // Check if a power leveled up
        function checkPowerLevelUp(power) {
            try {
                const powerData = state.powers[power];
                while (powerData.xp >= powerData.maxXp) {
                    powerData.level++;
                    powerData.xp -= powerData.maxXp;
                    powerData.maxXp = Math.floor(powerData.maxXp * 1.3);
                    showPowerUpModal(power);
                    powerUpSound.play().catch(err => console.error('Power up sound failed:', err));
                    console.log(`Power ${power} leveled up to ${powerData.level}!`);
                }
                saveState();
                updatePowersDisplay();
            } catch (err) {
                console.error('Error checking power level up:', err);
            }
        }

        // Show level up modal
        function showLevelUpModal() {
            try {
                document.getElementById('new-level').textContent = state.level;
                levelUpModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                const avatar = document.getElementById('avatar-container');
                avatar.classList.add('level-up');
                setTimeout(() => avatar.classList.remove('level-up'), 700);
                console.log('Level up modal shown');
            } catch (err) {
                console.error('Error showing level up modal:', err);
            }
        }

        // Show power up modal
        function showPowerUpModal(power) {
            try {
                const powerInfo = powerDetails[power];
                document.getElementById('power-name').textContent = powerInfo.name;
                document.getElementById('power-level').textContent = state.powers[power].level;
                document.getElementById('power-description').textContent = powerInfo.description;
                const icon = document.getElementById('power-icon');
                icon.className = `text-6xl mb-4 ${powerInfo.color}`;
                icon.innerHTML = `<i class="fas ${powerInfo.icon}"></i>`;
                powerUpModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                console.log('Power up modal shown for:', power);
            } catch (err) {
                console.error('Error showing power up modal:', err);
            }
        }

        // Render missions
        function renderMissions() {
            try {
                missionList.innerHTML = '';
                let active = 0, completed = 0;
                missions.forEach((mission, idx) => {
                    const div = document.createElement('div');
                    div.className = `flex items-center justify-between p-3 rounded-lg ${mission.done ? 'bg-green-900/40 text-green-300 line-through' : 'bg-gray-800/60'}`;
                    div.innerHTML = `
                        <span>${mission.text}</span>
                        <div class="flex items-center gap-2">
                            <button class="toggle-mission px-2 py-1 rounded btn-hunter text-xs" data-idx="${idx}">
                                ${mission.done ? '<i class="fas fa-undo"></i>' : '<i class="fas fa-check"></i>'}
                            </button>
                            <button class="delete-mission px-2 py-1 rounded btn-accent text-xs" data-idx="${idx}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    missionList.appendChild(div);
                    mission.done ? completed++ : active++;
                });
                activeMissionsCount.textContent = active;
                completedMissionsCount.textContent = completed;
                console.log('Missions rendered:', missions);
            } catch (err) {
                console.error('Error rendering missions:', err);
            }
        }

        // Save missions
        function saveMissions() {
            try {
                // Validate missions array
                if (!Array.isArray(missions)) {
                    console.warn('Missions is not an array, resetting to empty array');
                    missions = [];
                }
                
                const missionsJson = JSON.stringify(missions);
                if (!missionsJson) {
                    throw new Error('Failed to stringify missions');
                }
                
                if (state.userId) {
                    localStorage.setItem(`shadowMissions_${state.userId}`, missionsJson);
                    console.log('Missions saved for user:', state.userId, missions);
                } else {
                    localStorage.setItem('shadowMissions', missionsJson);
                    console.log('Missions saved to default location:', missions);
                }
            } catch (err) {
                console.error('Error saving missions:', err);
                showSystemMessage("Error saving missions. Please try again.", 3000, 'warning');
            }
        }

        // Add new quest
        function addNewQuest() {
            try {
                const type = document.getElementById('questType').value;
                const name = document.getElementById('questName').value.trim();
                const description = document.getElementById('questDescription').value.trim();
                const xp = parseInt(document.getElementById('questXP').value) || 50;
                const power = document.getElementById('questPower').value;
                
                if (!name || !description) {
                    alert('Please enter both a quest name and description');
                    return;
                }
                
                const newQuest = {
                    id: Date.now(),
                    type,
                    name,
                    description,
                    xp,
                    power,
                    completed: false
                };
                
                state.quests.unshift(newQuest);
                saveState();
                renderQuests();
                closeQuestModal();
                console.log('New quest added:', newQuest);
            } catch (err) {
                console.error('Error adding new quest:', err);
            }
        }

        // Add custom exercise
        function addCustomExercise() {
            try {
                const name = document.getElementById('customExerciseName').value.trim();
                if (!name) {
                    alert('Please enter an exercise name');
                    return;
                }
                const newExercise = {
                    id: Date.now(),
                    name,
                    type: "Custom",
                    description: "Custom exercise added by user"
                };
                state.exercises.unshift(newExercise);
                saveState();
                renderExerciseLibrary();
                renderExercisePreview();
                document.getElementById('customExerciseName').value = '';
                console.log('Custom exercise added:', newExercise);
            } catch (err) {
                console.error('Error adding custom exercise:', err);
            }
        }

        // Close quest modal
        function closeQuestModal() {
            try {
                questModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                document.getElementById('questName').value = '';
                document.getElementById('questDescription').value = '';
                document.getElementById('questXP').value = '50';
                console.log('Quest modal closed');
            } catch (err) {
                console.error('Error closing quest modal:', err);
            }
        }

        // Setup event listeners
function setupEventListeners() {
    try {
        // Avatar selection
        document.querySelectorAll('.avatar-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.avatar-option').forEach(opt => 
                    opt.classList.remove('selected')
                );
                option.classList.add('selected');
                selectedAvatar = option.dataset.avatar;
                state.user.avatar = avatarOptions[selectedAvatar];
                customAvatar = null;
                console.log('Avatar selected:', selectedAvatar);
            });
        });
        
        // Avatar upload
        avatarUpload.addEventListener('change', (e) => {
            try {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) {
                        alert('File size should be less than 2MB');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        customAvatar = event.target.result;
                        state.user.avatar = customAvatar;
                        userAvatar.src = customAvatar;
                        previewAvatar.src = customAvatar;
                        document.querySelectorAll('.avatar-option').forEach(opt => 
                            opt.classList.remove('selected')
                        );
                        console.log('Custom avatar uploaded');
                    };
                    reader.onerror = (err) => {
                        console.error('Error reading avatar file:', err);
                        alert('Failed to upload avatar. Please try again.');
                    };
                    reader.readAsDataURL(file);
                }
            } catch (err) {
                console.error('Error handling avatar upload:', err);
            }
        });
        
        // Background selection
        bgSelect.addEventListener('change', (e) => {
            try {
                if (e.target.value === 'custom') {
                    bgUploadContainer.classList.remove('hidden');
                } else {
                    bgUploadContainer.classList.add('hidden');
                    state.user.bgVideo = e.target.value;
                    
                    // Update training system background image based on selection
                    updateTrainingSystemBackground();
                    
                    console.log('Background selected:', state.user.bgVideo);
                }
            } catch (err) {
                console.error('Error handling background selection:', err);
            }
        });
        
        // Background upload
        bgUpload.addEventListener('change', (e) => {
            try {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('File size should be less than 5MB');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        customBgVideo = event.target.result;
                        state.user.bgVideo = 'custom';
                        
                        // Update training system background with custom image
                        const trainingSystemEl = document.getElementById('training-system');
                        if (trainingSystemEl) {
                            trainingSystemEl.style.backgroundImage = `url('${customBgVideo}')`;
                        }
                        
                        console.log('Custom background image uploaded');
                    };
                    reader.onerror = (err) => {
                        console.error('Error reading background image file:', err);
                        alert('Failed to upload background image. Please try again.');
                    };
                    reader.readAsDataURL(file);
                }
            } catch (err) {
                console.error('Error handling background upload:', err);
            }
        });
        
        // Name input preview
        hunterNameInput.addEventListener('input', updatePreview);
        
        // Save customization
        saveCustomizationBtn.addEventListener('click', () => {
            try {
                const name = hunterNameInput.value.trim();
                if (!name) {
                    alert('Please enter a hunter name');
                    return;
                }
                
                // Check if this is a new registration or editing existing user
                const isNewRegistration = !state.userId;
                
                state.user.name = name;
                saveCustomization();
                
                if (isNewRegistration) {
                    // Generate unique ID for new user
                    state.userId = 'hunterTrainingState_' + Date.now();
                    console.log('New user ID generated:', state.userId);
                }
                
                saveState(); // Save with proper ID
                updateUserDisplay();
                customizationModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                if (isNewRegistration) {
                    landingPage.classList.add('hidden');
                    trainingSystem.classList.remove('hidden');
                    updateFooterVisibility();
                    const video = document.getElementById('bg-video');
                    if (video) video.style.display = 'none';
                    signOutBtn.classList.remove('hidden');
                    showSystemMessage("Hunter Registered Successfully - Welcome to the Hunt!", 4000, 'success');
                } else {
                    showSystemMessage("Profile Updated Successfully", 3000, 'success');
                }
            } catch (err) {
                console.error('Error saving customization:', err);
            }
        });
        
        // Open customization modal from profile
        openCustomizationBtn.addEventListener('click', () => {
            try {
                // Change modal title and button text for editing
                document.querySelector('.id-card-header h2').innerHTML = '<i class="fas fa-edit mr-2"></i> EDIT HUNTER PROFILE';
                document.querySelector('.id-card-header p').textContent = 'Modify your hunter details and preferences';
                saveCustomizationBtn.innerHTML = '<i class="fas fa-save mr-2"></i> Update Profile';
                
                customizationModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                hunterNameInput.value = state.user.name;
                bgSelect.value = state.user.bgVideo;
                if (state.user.bgVideo === 'custom') {
                    bgUploadContainer.classList.remove('hidden');
                } else {
                    bgUploadContainer.classList.add('hidden');
                }
                document.querySelectorAll('.avatar-option').forEach(opt => {
                    opt.classList.toggle('selected', opt.dataset.avatar === selectedAvatar);
                });
                updatePreview(); // Update preview with current data
                
                // Ensure state.userId exists for editing (this user already has an ID)
                if (!state.userId) {
                    state.userId = 'hunterTrainingState'; // Default ID for existing users
                }
                
                console.log('Customization modal opened for editing');
            } catch (err) {
                console.error('Error opening customization modal:', err);
            }
        });
        
        // Register hunter button
        registerHunterBtn.addEventListener('click', () => {
            try {
                console.log('Register button clicked');
                landingPage.classList.add('hidden');
                customizationModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // Reset modal to registration mode
                document.querySelector('.id-card-header h2').innerHTML = '<i class="fas fa-id-card mr-2"></i> HUNTER ID REGISTRATION';
                document.querySelector('.id-card-header p').textContent = 'Enter your details to begin your journey as a Shadow Monarch';
                saveCustomizationBtn.innerHTML = '<i class="fas fa-save mr-2"></i> Register Hunter';
                
                // Reset state for new registration
                state.userId = null; // This ensures it's treated as a new registration
                hunterNameInput.value = '';
                bgSelect.value = '1';
                bgUploadContainer.classList.add('hidden');
                updatePreview();
                
                console.log('Registration modal opened for new user');
            } catch (err) {
                console.error('Error opening registration modal:', err);
            }
        });
        
        // Begin hunt button
        beginHuntBtn.addEventListener('click', () => {
            try {
                console.log('Begin hunt button clicked');
                console.log('beginHuntBtn element:', beginHuntBtn);
                console.log('showUserSelectionModal function:', typeof showUserSelectionModal);
                showUserSelectionModal();
            } catch (err) {
                console.error('Error starting training system:', err);
            }
        });
        
        // Quest completion
        questsContainer.addEventListener('click', (e) => {
            try {
                const btn = e.target.closest('.complete-btn');
                if (btn && !btn.disabled) {
                    const questId = parseInt(btn.dataset.id);
                    completeQuest(questId);
                }
            } catch (err) {
                console.error('Error handling quest completion:', err);
            }
        });
        
        // Open quest modal
        openQuestModalBtn.addEventListener('click', () => {
            try {
                questModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                console.log('Quest modal opened');
            } catch (err) {
                console.error('Error opening quest modal:', err);
            }
        });
        
        // Close quest modal
        closeQuestModalBtn.addEventListener('click', closeQuestModal);
        cancelQuestBtn.addEventListener('click', closeQuestModal);
        
        // Save quest
        saveQuestBtn.addEventListener('click', addNewQuest);
        
        // Open exercise modal
        openExerciseModalBtn.addEventListener('click', () => {
            try {
                exerciseModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                renderExerciseLibrary();
                console.log('Exercise modal opened');
            } catch (err) {
                console.error('Error opening exercise modal:', err);
            }
        });
        
        // Close exercise modal
        closeExerciseModalBtn.addEventListener('click', () => {
            try {
                exerciseModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                exerciseSearch.value = '';
                console.log('Exercise modal closed');
            } catch (err) {
                console.error('Error closing exercise modal:', err);
            }
        });
        
        // Search exercises
        exerciseSearch.addEventListener('input', (e) => {
            try {
                renderExerciseLibrary(e.target.value);
                console.log('Exercise search updated:', e.target.value);
            } catch (err) {
                console.error('Error searching exercises:', err);
            }
        });
        
        // Add custom exercise
        addCustomExerciseBtn.addEventListener('click', addCustomExercise);
        
        // Select exercise for quest
        exerciseLibrary.addEventListener('click', (e) => {
            try {
                const btn = e.target.closest('.select-exercise');
                if (btn) {
                    const exerciseId = parseInt(btn.dataset.id);
                    const exercise = state.exercises.find(ex => ex.id === exerciseId);
                    if (exercise) {
                        document.getElementById('questName').value = exercise.name;
                        document.getElementById('questDescription').value = exercise.description;
                        exerciseModal.classList.add('hidden');
                        questModal.classList.remove('hidden');
                        console.log('Exercise selected for quest:', exercise.name);
                    }
                }
            } catch (err) {
                console.error('Error selecting exercise:', err);
            }
        });
        
        // Close level up modal
        closeLevelUpBtn.addEventListener('click', () => {
            try {
                levelUpModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                console.log('Level up modal closed');
            } catch (err) {
                console.error('Error closing level up modal:', err);
            }
        });
        
        // Close power up modal
        closePowerUpBtn.addEventListener('click', () => {
            try {
                powerUpModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                console.log('Power up modal closed');
            } catch (err) {
                console.error('Error closing power up modal:', err);
            }
        });
        
        // Reset daily quests
        resetDailyBtn.addEventListener('click', resetDailyQuests);
        
        // Reset all progress
        resetProgressBtn.addEventListener('click', resetAllProgress);
        
        // Delete user
        deleteUserBtn.addEventListener('click', deleteUser);
        
        // Close customization modal
        closeCustomizationModalBtn.addEventListener('click', (e) => {
            console.log('Close button clicked');
            e.preventDefault();
            e.stopPropagation();
            closeCustomizationModal();
        });
        

        
        // Video volume control
        videoVolumeBtn.addEventListener('click', toggleVideoAudio);
        
        // Sign out
        signOutBtn.addEventListener('click', signOut);
        
        // User selection modal event listeners
        closeUserSelectionModalBtn.addEventListener('click', () => {
            try {
                userSelectionModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                console.log('User selection modal closed via close button');
            } catch (err) {
                console.error('Error closing user selection modal:', err);
            }
        });
        
        cancelUserSelectionBtn.addEventListener('click', () => {
            try {
                userSelectionModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                console.log('User selection modal closed via cancel button');
            } catch (err) {
                console.error('Error canceling user selection modal:', err);
            }
        });
        
        registerNewUserBtn.addEventListener('click', () => {
            try {
                userSelectionModal.classList.add('hidden');
                registerHunterBtn.click();
                console.log('Register new user button clicked');
            } catch (err) {
                console.error('Error registering new user:', err);
            }
        });
        
        // User selection
        registeredUsersList.addEventListener('click', (e) => {
            try {
                const selectBtn = e.target.closest('.select-user-btn');
                if (selectBtn) {
                    const userId = selectBtn.dataset.userId;
                    console.log('User selected:', userId);
                    loadUserData(userId);
                }
            } catch (err) {
                console.error('Error selecting user:', err);
            }
        });
        
        // Keyboard shortcut to close modal (Escape key)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (!customizationModal.classList.contains('hidden')) {
                    closeCustomizationModal();
                } else if (!userSelectionModal.classList.contains('hidden')) {
                    userSelectionModal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            }
        });
        
        // Click outside modal to close
        customizationModal.addEventListener('click', (e) => {
            if (e.target === customizationModal) {
                closeCustomizationModal();
            }
        });
        
        // Close modal when clicking outside
        userSelectionModal.addEventListener('click', (e) => {
            if (e.target === userSelectionModal) {
                userSelectionModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                console.log('User selection modal closed via overlay click');
            }
        });
        
        // Add mission
        addMissionBtn.addEventListener('click', () => {
            try {
                const text = missionInput.value.trim();
                if (text) {
                    missions.push({ text, done: false });
                    missionInput.value = '';
                    saveMissions();
                    renderMissions();
                    console.log('Mission added:', text);
                }
            } catch (err) {
                console.error('Error adding mission:', err);
            }
        });
        
        // Toggle mission
        missionList.addEventListener('click', (e) => {
            try {
                const toggleBtn = e.target.closest('.toggle-mission');
                const deleteBtn = e.target.closest('.delete-mission');
                if (toggleBtn) {
                    const idx = parseInt(toggleBtn.dataset.idx);
                    missions[idx].done = !missions[idx].done;
                    saveMissions();
                    renderMissions();
                    console.log(`Mission ${idx} toggled to ${missions[idx].done ? 'done' : 'active'}`);
                } else if (deleteBtn) {
                    const idx = parseInt(deleteBtn.dataset.idx);
                    missions.splice(idx, 1);
                    saveMissions();
                    renderMissions();
                    console.log(`Mission ${idx} deleted`);
                }
            } catch (err) {
                console.error('Error handling mission interaction:', err);
            }
        });
        
        // Clear completed missions
        clearMissionsBtn.addEventListener('click', () => {
            try {
                missions = missions.filter(m => !m.done);
                saveMissions();
                renderMissions();
                console.log('Completed missions cleared');
            } catch (err) {
                console.error('Error clearing missions:', err);
            }
        });
        
        // Save missions
        saveMissionsBtn.addEventListener('click', () => {
            try {
                saveMissions();
                alert('Missions archived successfully!');
                console.log('Missions archived');
            } catch (err) {
                console.error('Error archiving missions:', err);
            }
        });
        
        console.log('Event listeners set up');
    } catch (err) {
        console.error('Error setting up event listeners:', err);
    }
}

        // Initialize the app on load
        document.addEventListener('DOMContentLoaded', () => {
            try {
                init();
            } catch (err) {
                console.error('Critical error during app initialization:', err);
                showSystemMessage("Critical error during initialization. Please refresh the page.", 5000, 'warning');
            }
        });
        

        
        // Ensure video plays on any user interaction
        document.addEventListener('click', () => {
            const video = document.getElementById('bg-video');
            if (video && video.paused) {
                video.play().catch(e => console.warn('Video play on interaction failed:', e));
            }
        }, { once: true });
        
        // Data backup and recovery system
        function backupUserData() {
            try {
                if (state.userId && state.user) {
                    const backup = {
                        timestamp: Date.now(),
                        userId: state.userId,
                        userData: JSON.stringify(state),
                        missions: JSON.stringify(missions)
                    };
                    localStorage.setItem(`backup_${state.userId}`, JSON.stringify(backup));
                    console.log('User data backed up successfully');
                }
            } catch (err) {
                console.error('Error backing up user data:', err);
            }
        }
        
        function recoverUserData(userId) {
            try {
                const backupData = localStorage.getItem(`backup_${userId}`);
                if (backupData) {
                    const backup = JSON.parse(backupData);
                    if (backup.userData) {
                        const userData = JSON.parse(backup.userData);
                        Object.assign(state, userData);
                        console.log('User data recovered from backup');
                        return true;
                    }
                }
                return false;
            } catch (err) {
                console.error('Error recovering user data:', err);
                return false;
            }
        }
        
        // Auto-backup every 5 minutes
        setInterval(() => {
            if (state.userId && !trainingSystem.classList.contains('hidden')) {
                backupUserData();
            }
        }, 5 * 60 * 1000);

        // Digital Clock UI
        function updateDigitalClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;
            const dateString = now.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
            document.getElementById('digital-clock').textContent = timeString;
            document.getElementById('digital-date').textContent = dateString;
        }
        setInterval(updateDigitalClock, 1000);
        updateDigitalClock();

        // Footer visibility logic
        function updateFooterVisibility() {
            const footer = document.getElementById('main-footer');
            if (!footer) return;
            if (trainingSystem.classList.contains('hidden')) {
                // On landing page
                footer.style.display = 'block';
            } else {
                // On main content page
                footer.style.display = 'none';
            }
        }
        // Call updateFooterVisibility whenever switching pages
        // ... existing code ...
        // After showing/hiding landingPage or trainingSystem, call updateFooterVisibility();
    </script>
</body>
</html>
